<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chromosome ideograms – geneinfo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c75bcb89907db7808f0349b764a1a524.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../api/_styles-quartodoc.css">
<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">geneinfo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../api/"> 
<span class="menu-text">API reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gallery/"> 
<span class="menu-text">Gallery</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/munch-group/geneinfo/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-issue-seems-to-be-that-i-compute-ylimits-using-the-input-data-to-horizonplot-not-the-data-it-plots" id="toc-the-issue-seems-to-be-that-i-compute-ylimits-using-the-input-data-to-horizonplot-not-the-data-it-plots" class="nav-link active" data-scroll-target="#the-issue-seems-to-be-that-i-compute-ylimits-using-the-input-data-to-horizonplot-not-the-data-it-plots">the issue seems to be that I compute ylimits using the input data to horizonplot, not the data it plots…</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chromosome ideograms</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-2" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'white'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># %config InlineBackend.figure_format = 'retina'</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'svg'</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geneinfo <span class="im">as</span> gi</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#gi.email('your@email.com')</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geneinfo.plot <span class="im">import</span> chrom_ideogram</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>annotation <span class="op">=</span> [</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'chr1'</span>, <span class="dv">50000000</span>, <span class="dv">50001000</span>),                          <span class="co"># segment color defaults to red</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'chr2'</span>, <span class="dv">10000000</span>, <span class="dv">1000000</span>, <span class="st">'green'</span>),                  <span class="co"># with segment color</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'chr3'</span>, <span class="dv">45000000</span>, <span class="dv">55000000</span>, <span class="st">'blue'</span>, <span class="st">'NAME'</span>),          <span class="co"># with name label</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'chr6'</span>, <span class="dv">10000000</span>, <span class="dv">15000000</span>, <span class="st">'magenta'</span>, <span class="va">None</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="co"># with base and height</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'chr6'</span>, <span class="dv">10000000</span>, <span class="dv">15000000</span>, <span class="st">'pink'</span>, <span class="va">None</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>),  <span class="co"># with base and height</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>chrom_ideogram(annotation, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>)) <span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-3-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="chrom_ideograms-Copy2_files/figure-html/cell-3-output-1.png" width="656" height="700" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>To make sure segments are visible on the plot, the default minimal size of plotteed segments are 200000. This can be changed like this (notice how the chr1 segment is no longer visible):</p>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>chrom_ideogram(annotation, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), min_visible_width<span class="op">=</span><span class="dv">1</span>, hspace<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-4-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="chrom_ideograms-Copy2_files/figure-html/cell-4-output-1.png" width="656" height="700" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Other assembly, figure dimentions:</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>chrom_ideogram(annotation, assembly<span class="op">=</span><span class="st">'hg19'</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-5-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="chrom_ideograms-Copy2_files/figure-html/cell-5-output-1.png" width="656" height="700" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>You can add position markers along a chromosome like this to better see the location of some segments:</strong></p>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chrom <span class="op">=</span> <span class="st">'chr3'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">100000000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> <span class="dv">200000000</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">10000000</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>annotation2 <span class="op">=</span> annotation <span class="op">+</span> [(chrom, x[<span class="dv">0</span>], x[<span class="dv">1</span>], <span class="st">'black'</span>, <span class="bu">str</span>(x[<span class="dv">2</span>]<span class="op">/</span>width)) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span>(start, end, width), </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span>(start<span class="op">+</span><span class="dv">1</span>, end, width), </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span>(start, end, width)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>chrom_ideogram(annotation2, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-6-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="chrom_ideograms-Copy2_files/figure-html/cell-6-output-1.png" width="656" height="700" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geneinfo.utils <span class="im">import</span> GoogleSheet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lists <span class="op">=</span> GoogleSheet()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geneinfo</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(geneinfo)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> gi.gene_coord(lists.get(<span class="st">'xi_escape'</span>), assembly<span class="op">=</span><span class="st">'GRCh38'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>annotation <span class="op">=</span> [(c, s, e, <span class="st">'red'</span>, g) <span class="cf">for</span> g, (c, s, e, _) <span class="kw">in</span> coords.items()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> gi.gene_coord([<span class="st">'ATRX'</span>, <span class="st">'MAGT1'</span>], assembly<span class="op">=</span><span class="st">'GRCh38'</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>annotation <span class="op">=</span> [(c, s, e, <span class="st">'red'</span>, g) <span class="cf">for</span> g, (c, s, e, _) <span class="kw">in</span> coords.items()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Polygon:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, points):</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.points <span class="op">=</span> points</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_points(<span class="va">self</span>):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.points</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> nudge_y(<span class="va">self</span>, nudge):</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> point <span class="kw">in</span> <span class="va">self</span>.points:</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            point.y <span class="op">+=</span> nudge</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_polygons_intersecting(a, b):</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        polygon <span class="op">=</span> a <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> b</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i1 <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(polygon.get_points())):</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            i2 <span class="op">=</span> (i1 <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(polygon.get_points())</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            p1 <span class="op">=</span> polygon.get_points()[i1]</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            p2 <span class="op">=</span> polygon.get_points()[i2]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            normal <span class="op">=</span> Point(p2.y <span class="op">-</span> p1.y, p1.x <span class="op">-</span> p2.x)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            min_a <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            max_a <span class="op">=</span> <span class="bu">float</span>(<span class="st">'-inf'</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> p <span class="kw">in</span> a.get_points():</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                projected <span class="op">=</span> normal.x <span class="op">*</span> p.x <span class="op">+</span> normal.y <span class="op">*</span> p.y</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                min_a <span class="op">=</span> <span class="bu">min</span>(min_a, projected)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                max_a <span class="op">=</span> <span class="bu">max</span>(max_a, projected)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            min_b <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            max_b <span class="op">=</span> <span class="bu">float</span>(<span class="st">'-inf'</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> p <span class="kw">in</span> b.get_points():</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                projected <span class="op">=</span> normal.x <span class="op">*</span> p.x <span class="op">+</span> normal.y <span class="op">*</span> p.y</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                min_b <span class="op">=</span> <span class="bu">min</span>(min_b, projected)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>                max_b <span class="op">=</span> <span class="bu">max</span>(max_b, projected)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> max_a <span class="op">&lt;</span> min_b <span class="kw">or</span> max_b <span class="op">&lt;</span> min_a:</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>]))</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>]))</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>is_polygons_intersecting(</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    Polygon([Point(<span class="op">*</span>tup) <span class="cf">for</span> tup <span class="kw">in</span> a]),</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    Polygon([Point(<span class="op">*</span>tup) <span class="cf">for</span> tup <span class="kw">in</span> b])</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> chain</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import gc</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.nonparametric.smoothers_lowess <span class="im">import</span> lowess</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Make inline plots vector graphics instead of raster graphics</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># from IPython.display import set_matplotlib_formats</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># set_matplotlib_formats('pdf', 'svg')</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> isclose, floor, log10</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizon(row, i, cut):</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the values for the three </span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">    positive and negative intervals.</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="bu">getattr</span>(row, i)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.isnan(val):</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>):</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for nan color</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> cut</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">abs</span>(val)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> <span class="bu">min</span>(cut, val)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, val<span class="op">-</span>cut)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> <span class="bu">int</span>(<span class="kw">not</span> isclose(val, <span class="dv">0</span>, abs_tol<span class="op">=</span><span class="fl">1e-8</span>)) <span class="op">*</span> cut</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for nan color</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizonplot(df, y<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>                cut<span class="op">=</span><span class="va">None</span>, <span class="co"># float, takes precedence over quantile_span</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>                quantile_span <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span><span class="st">'start'</span>,</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>                beginzero<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>                offset<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>                height<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>                colors <span class="op">=</span> [<span class="st">'#CCE2DF'</span>, <span class="st">'#59A9A8'</span>, <span class="st">'#374E9B'</span>, <span class="st">'midnightblue'</span>,</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'#F2DE9A'</span>, <span class="st">'#DA8630'</span>, <span class="st">'#972428'</span>, <span class="st">'darkred'</span>,</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'#D3D3D3'</span>]):</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>                <span class="co"># colours = ['#314E9F', '#36AAA8', '#D7E2D4'] + ['midnightblue'] + \</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>                <span class="co">#           ['#F5DE90', '#F5DE90', '#A51023'] + ['darkred'] + ['whitesmoke']):</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>                <span class="co"># colors = sns.color_palette("Blues", 3) + ['midnightblue'] + \</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>                <span class="co">#           sns.color_palette("Reds", 3) + ['darkred'] + ['lightgrey']):</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Horizon bar plot made allowing multiple chromosomes and multiple samples.</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set cut if not set</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cut <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>        cut <span class="op">=</span> np.<span class="bu">max</span>([np.<span class="bu">max</span>(df[y]), np.<span class="bu">max</span>(<span class="op">-</span>df[y])]) <span class="op">/</span> <span class="dv">3</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> quantile_span:</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>        cut<span class="op">=</span><span class="bu">max</span>(np.<span class="bu">abs</span>(np.nanquantile(df[col], quantile_span[<span class="dv">0</span>])), </span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>                np.<span class="bu">abs</span>(np.nanquantile(df[col], quantile_span[<span class="dv">1</span>]))) <span class="op">/</span> <span class="dv">3</span>,</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make the data frame to plot</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    row_iter <span class="op">=</span> df.itertuples()</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>    col_iterators <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>(horizon(row, y, cut) <span class="cf">for</span> row <span class="kw">in</span> row_iter))</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    col_names <span class="op">=</span> [<span class="st">'yp1'</span>, <span class="st">'yp2'</span>, <span class="st">'yp3'</span>, <span class="st">'yp4'</span>, </span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'yn1'</span>, <span class="st">'yn2'</span>, <span class="st">'yn3'</span>, <span class="st">'yn4'</span>, <span class="st">'nan'</span>]</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> (df[[y, x]]</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>           .assign(<span class="op">**</span><span class="bu">dict</span>(<span class="bu">zip</span>(col_names, col_iterators)))</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>((col, <span class="bu">list</span>(chain.from_iterable(<span class="bu">zip</span>(df2[col].values, df2[col].values)))) <span class="cf">for</span> col <span class="kw">in</span> df2))</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make the plot</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> sns.axes_style(<span class="st">"ticks"</span>):</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ingore UserWarning from seaborn that tight_layout is not applied</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>            warnings.simplefilter(<span class="st">"ignore"</span>)</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>            <span class="co"># first y tick</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>            ytic1 <span class="op">=</span> <span class="bu">round</span>(cut<span class="op">/</span><span class="dv">3</span>, <span class="op">-</span><span class="bu">int</span>(floor(log10(<span class="bu">abs</span>(cut<span class="op">/</span><span class="dv">3</span>)))))</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>            scale <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> height <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>                ymax <span class="op">=</span> <span class="bu">max</span>(df2[col_name].<span class="bu">max</span>() <span class="cf">for</span> col_name <span class="kw">in</span> col_names)</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>                ymin <span class="op">=</span> <span class="bu">max</span>(df2[col_name].<span class="bu">min</span>() <span class="cf">for</span> col_name <span class="kw">in</span> col_names)</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>                scale <span class="op">=</span> height<span class="op">/</span>(ymax<span class="op">-</span>ymin)</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col_name, color <span class="kw">in</span> <span class="bu">zip</span>(col_names, colors):</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>                plt.setp(fig.texts, text<span class="op">=</span><span class="st">""</span>) <span class="co"># hack to make y facet labels align...</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>                ax.fill_between(</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>                    df2[x], </span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>                    df2[col_name]<span class="op">*</span>scale<span class="op">+</span>offset, </span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>                    y2<span class="op">=</span>offset,</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span>color,</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>                    linewidth<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>                    capstyle<span class="op">=</span><span class="st">'butt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'chrom'</span>: [<span class="st">'chr1'</span>]<span class="op">*</span>n,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'start'</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span><span class="op">*</span>n)), </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'pi'</span>: <span class="bu">list</span>(np.sin(np.linspace(<span class="op">-</span>np.pi, <span class="dv">10</span><span class="op">*</span>np.pi, <span class="dv">1</span><span class="op">*</span>n)))                   </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                  })</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> n</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>Fs <span class="op">=</span> <span class="dv">248956422</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># f = 50</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.linspace(<span class="dv">5</span>, <span class="dv">50</span>, sample)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, Fs, sample)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span> np.pi <span class="op">*</span> f <span class="op">*</span> x <span class="op">/</span> Fs)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pi'</span>] <span class="op">=</span> y</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>horizonplot(df, y<span class="op">=</span><span class="st">'pi'</span>, x<span class="op">=</span><span class="st">'start'</span>, offset<span class="op">=</span><span class="dv">0</span>, height<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_axis_off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-13-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="chrom_ideograms-Copy2_files/figure-html/cell-13-output-1.png" width="824" height="124" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from matplotlib import patches</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, ax = plt.subplots(1, 1)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_xlim(0, 5)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_ylim(0, 5)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># offset = 1</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># scale = 3</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># xy = np.array([[0, 0], [1, 1], [2, 1], [3, 1], [4, 0]]) </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># xy[:, 1] = xy[:, 1] * scale + offset</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># poly = patches.Polygon(xy, closed=False, fc='blue', ec='none')</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.add_patch(poly)    </span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # xy = np.array([[1, 0], [2, 1], [3, 0], [3, 0]])</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># xy[:, 1] = xy[:, 1] * scale + offset</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># poly = patches.Polygon(xy, closed=False, fc='red', ec='none')</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.add_patch(poly)    </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_lowess(x, y, ax<span class="op">=</span><span class="va">None</span>, color<span class="op">=</span><span class="va">None</span>, is_sorted<span class="op">=</span><span class="va">True</span>, frac<span class="op">=</span><span class="fl">0.005</span>, it<span class="op">=</span><span class="dv">0</span>, lowess_kwargs<span class="op">=</span>{}, <span class="op">**</span>kwargs):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add a lowess curve to the plot"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.gca() </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> lowess(y, x, is_sorted<span class="op">=</span>is_sorted, frac<span class="op">=</span>frac, it<span class="op">=</span>it, <span class="op">**</span>lowess_kwargs)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    ax.plot(filtered[:,<span class="dv">0</span>], filtered[:,<span class="dv">1</span>], <span class="op">**</span>kwargs)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_band(x_low, x_high, y_low<span class="op">=</span><span class="va">None</span>, y_high<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>, color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="dv">0</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, zorder<span class="op">=</span><span class="dv">0</span>, <span class="op">**</span>kwargs):</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Plot a gray block on x interval"</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.gca()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_low <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        y_low, _ <span class="op">=</span> ax.get_ylim()</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_high <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        _, y_high <span class="op">=</span> ax.get_ylim()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> ax.add_patch(Rectangle((x_low, y_low), x_high<span class="op">-</span>x_low, y_high<span class="op">-</span>y_low, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                 facecolor<span class="op">=</span>color,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                 linewidth<span class="op">=</span>linewidth,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                 alpha<span class="op">=</span>alpha,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                 zorder<span class="op">=</span>zorder,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                 <span class="op">**</span>kwargs))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stairs(df, start<span class="op">=</span><span class="st">'start'</span>, end<span class="op">=</span><span class="st">'end'</span>, pos<span class="op">=</span><span class="st">'pos'</span>, endtrim<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Turn a df with start, end into one with pos to plot as stairs"</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    df1 <span class="op">=</span> df.copy(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> df.copy(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    df1[pos] <span class="op">=</span> df1[start]</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    df2[pos] <span class="op">=</span> df2[end] <span class="op">-</span> endtrim</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat([df1, df2]).sort_values([start, end])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> patches</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.artist <span class="im">import</span> Artist</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.gridspec <span class="im">as</span> gridspec</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> sub</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> cycle</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.lines <span class="im">import</span> Line2D</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.axes <span class="im">import</span> Axes</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.transforms <span class="im">import</span> (Bbox, TransformedBbox,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                                   blended_transform_factory)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> (BboxConnector,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                                   BboxConnectorPatch,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                                                   BboxPatch)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> chain</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># import gc</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.nonparametric.smoothers_lowess <span class="im">import</span> lowess</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># # Make inline plots vector graphics instead of raster graphics</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co"># from IPython.display import set_matplotlib_formats</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co"># set_matplotlib_formats('pdf', 'svg')</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> isclose, floor, log10</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point:</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Polygon:</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, points):</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.points <span class="op">=</span> points</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_points(<span class="va">self</span>):</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.points</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> nudge_y(<span class="va">self</span>, nudge):</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> point <span class="kw">in</span> <span class="va">self</span>.points:</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>            point.y <span class="op">+=</span> nudge</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GenomeIdeogram(<span class="bu">object</span>):</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> {<span class="st">'axes.linewidth'</span>: <span class="fl">0.8</span>, <span class="st">'grid.linewidth'</span>: <span class="fl">0.64</span>, <span class="st">'lines.linewidth'</span>: <span class="fl">0.96</span>, </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>         <span class="st">'lines.markersize'</span>: <span class="fl">3.84</span>, <span class="st">'patch.linewidth'</span>: <span class="fl">0.64</span>, <span class="st">'xtick.major.width'</span>: <span class="fl">0.8</span>,</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>         <span class="st">'ytick.major.width'</span>: <span class="fl">0.8</span>, <span class="st">'xtick.minor.width'</span>: <span class="fl">0.64</span>, <span class="st">'ytick.minor.width'</span>: <span class="fl">0.64</span>,</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>         <span class="st">'xtick.major.size'</span>: <span class="fl">3.84</span>, <span class="st">'ytick.major.size'</span>: <span class="fl">3.84</span>, <span class="st">'xtick.minor.size'</span>: <span class="fl">2.56</span>, </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>         <span class="st">'ytick.minor.size'</span>: <span class="fl">2.56</span>, <span class="st">'font.size'</span>: <span class="fl">7.68</span>, <span class="st">'axes.labelsize'</span>: <span class="fl">7.68</span>,</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>         <span class="st">'axes.titlesize'</span>: <span class="fl">7.68</span>, <span class="st">'xtick.labelsize'</span>: <span class="fl">7.04</span>, <span class="st">'ytick.labelsize'</span>: <span class="fl">7.04</span>, </span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>         <span class="st">'legend.fontsize'</span>: <span class="fl">7.04</span>, <span class="st">'legend.title_fontsize'</span>: <span class="fl">7.68</span>}</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    chrom_lengths <span class="op">=</span> {<span class="st">'hg19'</span>: {<span class="st">'chr1'</span>: <span class="dv">249250621</span>, <span class="st">'chr2'</span>: <span class="dv">243199373</span>, <span class="st">'chr3'</span>: <span class="dv">198022430</span>, <span class="st">'chr4'</span>: <span class="dv">191154276</span>, </span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr5'</span>: <span class="dv">180915260</span>, <span class="st">'chr6'</span>: <span class="dv">171115067</span>, <span class="st">'chr7'</span>: <span class="dv">159138663</span>, <span class="st">'chr8'</span>: <span class="dv">146364022</span>, </span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr9'</span>: <span class="dv">141213431</span>, <span class="st">'chr10'</span>: <span class="dv">135534747</span>, <span class="st">'chr11'</span>: <span class="dv">135006516</span>, <span class="st">'chr12'</span>: <span class="dv">133851895</span>,</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr13'</span>: <span class="dv">115169878</span>, <span class="st">'chr14'</span>: <span class="dv">107349540</span>, <span class="st">'chr15'</span>: <span class="dv">102531392</span>, <span class="st">'chr16'</span>: <span class="dv">90354753</span>, </span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr17'</span>: <span class="dv">81195210</span>, <span class="st">'chr18'</span>: <span class="dv">78077248</span>, <span class="st">'chr19'</span>: <span class="dv">59128983</span>, <span class="st">'chr20'</span>: <span class="dv">63025520</span>, </span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr21'</span>: <span class="dv">48129895</span>, <span class="st">'chr22'</span>: <span class="dv">51304566</span>, <span class="st">'chrX'</span>: <span class="dv">155270560</span>, <span class="st">'chrY'</span>: <span class="dv">59373566</span>},</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'hg38'</span>: {<span class="st">'chr1'</span>: <span class="dv">248956422</span>, <span class="st">'chr2'</span>: <span class="dv">242193529</span>, <span class="st">'chr3'</span>: <span class="dv">198295559</span>, <span class="st">'chr4'</span>: <span class="dv">190214555</span>, </span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr5'</span>: <span class="dv">181538259</span>, <span class="st">'chr6'</span>: <span class="dv">170805979</span>, <span class="st">'chr7'</span>: <span class="dv">159345973</span>, <span class="st">'chr8'</span>: <span class="dv">145138636</span>, </span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr9'</span>: <span class="dv">138394717</span>, <span class="st">'chr10'</span>: <span class="dv">133797422</span>, <span class="st">'chr11'</span>: <span class="dv">135086622</span>, <span class="st">'chr12'</span>: <span class="dv">133275309</span>, </span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr13'</span>: <span class="dv">114364328</span>, <span class="st">'chr14'</span>: <span class="dv">107043718</span>, <span class="st">'chr15'</span>: <span class="dv">101991189</span>, <span class="st">'chr16'</span>: <span class="dv">90338345</span>, </span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr17'</span>: <span class="dv">83257441</span>, <span class="st">'chr18'</span>: <span class="dv">80373285</span>, <span class="st">'chr19'</span>: <span class="dv">58617616</span>, <span class="st">'chr20'</span>: <span class="dv">64444167</span>, </span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'chr21'</span>: <span class="dv">46709983</span>, <span class="st">'chr22'</span>: <span class="dv">50818468</span>, <span class="st">'chrX'</span>: <span class="dv">156040895</span>, <span class="st">'chrY'</span>: <span class="dv">57227415</span>}}    </span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: make the centromeres fit each assembly!</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    centromeres <span class="op">=</span> {</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr1'</span>:    (<span class="dv">121700000</span>, <span class="dv">125100000</span>),</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr10'</span>:   (<span class="dv">38000000</span>, <span class="dv">41600000</span>),</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr11'</span>:   (<span class="dv">51000000</span>, <span class="dv">55800000</span>),</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr12'</span>:   (<span class="dv">33200000</span>, <span class="dv">37800000</span>),</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr13'</span>:   (<span class="dv">16500000</span>, <span class="dv">18900000</span>),</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr14'</span>:   (<span class="dv">16100000</span>, <span class="dv">18200000</span>),</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr15'</span>:   (<span class="dv">17500000</span>, <span class="dv">20500000</span>),</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr16'</span>:   (<span class="dv">35300000</span>, <span class="dv">38400000</span>),</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr17'</span>:   (<span class="dv">22700000</span>, <span class="dv">27400000</span>),</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr18'</span>:   (<span class="dv">15400000</span>, <span class="dv">21500000</span>),</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr19'</span>:   (<span class="dv">24200000</span>, <span class="dv">28100000</span>),</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr2'</span>:    (<span class="dv">91800000</span>, <span class="dv">96000000</span>),</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr20'</span>:   (<span class="dv">25700000</span>, <span class="dv">30400000</span>),</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr21'</span>:   (<span class="dv">10900000</span>, <span class="dv">13000000</span>),</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr22'</span>:   (<span class="dv">13700000</span>, <span class="dv">17400000</span>),</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr3'</span>:    (<span class="dv">87800000</span>, <span class="dv">94000000</span>),</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr4'</span>:    (<span class="dv">48200000</span>, <span class="dv">51800000</span>),</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr5'</span>:    (<span class="dv">46100000</span>, <span class="dv">51400000</span>),</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr6'</span>:    (<span class="dv">58500000</span>, <span class="dv">62600000</span>),</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr7'</span>:    (<span class="dv">58100000</span>, <span class="dv">62100000</span>),</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr8'</span>:    (<span class="dv">43200000</span>, <span class="dv">47200000</span>),</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chr9'</span>:    (<span class="dv">42200000</span>, <span class="dv">45500000</span>),</span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chrX'</span>:    (<span class="dv">58100000</span>, <span class="dv">63800000</span>),</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">'chrY'</span>:    (<span class="dv">10300000</span>, <span class="dv">10400000</span>)}                     </span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, axes_height_inches<span class="op">=</span><span class="dv">1</span>, axes_width_inches<span class="op">=</span><span class="dv">12</span>, hspace<span class="op">=</span><span class="dv">0</span>, ylim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>                 rel_font_height<span class="op">=</span><span class="fl">0.05</span>, assembly:<span class="bu">str</span><span class="op">=</span><span class="st">'hg38'</span>, min_stick_height<span class="op">=</span><span class="fl">0.3</span>):</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_base <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_height <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.min_stick_height <span class="op">=</span> min_stick_height</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.legend_handles <span class="op">=</span> []</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.zoom_axes <span class="op">=</span> []</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.end_padding <span class="op">=</span> <span class="dv">300000</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chr_names <span class="op">=</span> [<span class="ss">f'chr</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">23</span>))<span class="op">+</span>[<span class="st">'X'</span>, <span class="st">'Y'</span>]]</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chr_sizes <span class="op">=</span> [<span class="va">self</span>.chrom_lengths[assembly][chrom] <span class="cf">for</span> chrom <span class="kw">in</span> <span class="va">self</span>.chr_names]</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_chrom_size <span class="op">=</span> <span class="bu">max</span>(<span class="va">self</span>.chr_sizes)</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>        nr_rows <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.chr_names) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.aspect <span class="op">=</span> axes_height_inches <span class="op">/</span> axes_width_inches</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>        axes_width <span class="op">=</span> <span class="va">self</span>.max_chrom_size <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.end_padding</span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>        axes_height <span class="op">=</span> <span class="va">self</span>.aspect <span class="op">*</span> axes_width</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>        fig_height_inches <span class="op">=</span> axes_height_inches <span class="op">*</span> (nr_rows<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> hspace <span class="op">*</span> (nr_rows<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>        fig_width_inches <span class="op">=</span> axes_width_inches <span class="co">#fig_height_inches / (nr_rows-1) / aspect </span></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>        figsize <span class="op">=</span> (fig_width_inches, fig_height_inches)</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>        point_size <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">72</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ylim <span class="op">=</span> ylim</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.font_size <span class="op">=</span> rel_font_height <span class="op">*</span> axes_height_inches <span class="op">/</span> point_size</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>        plt.subplots_adjust(hspace<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> plt.rc_context(<span class="va">self</span>.d):</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>            nr_rows, nr_cols <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.chr_names)<span class="op">-</span><span class="dv">2</span><span class="op">+</span><span class="dv">1</span>, <span class="dv">2</span></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fig = plt.figure(figsize=figsize)</span></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>            <span class="co"># gs = matplotlib.gridspec.GridSpec(nr_rows, 25)</span></span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>            gs <span class="op">=</span> matplotlib.gridspec.GridSpec(nr_rows<span class="op">+</span><span class="dv">1</span>, <span class="dv">25</span>, height_ratios<span class="op">=</span>[<span class="fl">1e-2</span>]<span class="op">+</span>[<span class="dv">1</span>]<span class="op">*</span>nr_rows)</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>            gs.update(wspace<span class="op">=</span><span class="dv">0</span>, hspace<span class="op">=</span>hspace) </span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>            dummy_ax <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, :])</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>            xlim <span class="op">=</span> (<span class="op">-</span><span class="va">self</span>.end_padding, <span class="va">self</span>.max_chrom_size<span class="op">+</span><span class="va">self</span>.end_padding)</span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>            dummy_ax.set_xlim(xlim)</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>            <span class="co"># dummy_ax.spines[['right', 'top', 'left', 'bottom']].set_visible(False)</span></span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>            dummy_ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">True</span>)</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>            dummy_ax.xaxis.tick_top()</span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>            dummy_ax.xaxis.set_label_position(<span class="st">'top'</span>) </span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>            dummy_ax.yaxis.set_ticks_position(<span class="st">'none'</span>)</span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>            dummy_ax.set_yticklabels([])</span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>            ax_list <span class="op">=</span> [plt.subplot(gs[i, :]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, nr_rows<span class="op">-</span><span class="dv">2</span>)]</span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>            ax_list.append(plt.subplot(gs[nr_rows<span class="op">-</span><span class="dv">2</span>, :<span class="dv">9</span>]))</span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>            ax_list.append(plt.subplot(gs[nr_rows<span class="op">-</span><span class="dv">1</span>, :<span class="dv">9</span>]))</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>            ax_list.append(plt.subplot(gs[nr_rows<span class="op">-</span><span class="dv">2</span>, <span class="dv">9</span>:]))</span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>            ax_list.append(plt.subplot(gs[nr_rows<span class="op">-</span><span class="dv">1</span>, <span class="dv">9</span>:]))</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax_list <span class="op">=</span> ax_list</span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.chr_axes <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="va">self</span>.chr_names, <span class="va">self</span>.ax_list))</span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.ax_list[:<span class="op">-</span><span class="dv">4</span>]:</span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>                xlim <span class="op">=</span> (<span class="op">-</span>end_padding, <span class="va">self</span>.max_chrom_size<span class="op">+</span>end_padding)</span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a>                scaled_y_lim <span class="op">=</span> xlim[<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.aspect, xlim[<span class="dv">1</span>] <span class="op">*</span> <span class="va">self</span>.aspect</span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>                ax.set_xlim(xlim)</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>                ax.set_ylim(scaled_y_lim)</span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> ax_list[<span class="op">-</span><span class="dv">4</span>:]:</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a>                xlim <span class="op">=</span> (<span class="op">-</span>end_padding, ((<span class="dv">25</span><span class="op">-</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">25</span>)<span class="op">*</span><span class="va">self</span>.max_chrom_size<span class="op">+</span>end_padding)</span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>                scaled_y_lim <span class="op">=</span> xlim[<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.aspect, xlim[<span class="dv">1</span>] <span class="op">*</span> <span class="va">self</span>.aspect</span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>                ax.set_xlim(xlim)</span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a>                ax.set_ylim(scaled_y_lim)</span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.ax_list)):</span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>                chrom <span class="op">=</span> <span class="va">self</span>.chr_names[i]</span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> ax_list[i]</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>                start, end <span class="op">=</span> <span class="dv">0</span>, <span class="va">self</span>.chr_sizes[i]</span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>                ax.spines[[<span class="st">'right'</span>, <span class="st">'top'</span>, <span class="st">'left'</span>, <span class="st">'bottom'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.spines['top'].set_visible(False)</span></span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.spines['right'].set_visible(False)</span></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.spines['bottom'].set_visible(False)</span></span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.spines['left'].set_visible(False)</span></span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.set_ylim((0, 3))</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.set_ylim((0, 5))</span></span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">20</span>, <span class="dv">21</span>]:   </span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">=</span> <span class="op">-</span><span class="dv">3500000</span> <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> figsize[<span class="dv">1</span>]</span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">=</span> <span class="op">-</span><span class="dv">2000000</span> <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> figsize[<span class="dv">1</span>]</span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>                ax.text(x, <span class="va">self</span>.map_y(<span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim), ax)<span class="op">/</span><span class="dv">2</span>, chrom.replace(<span class="st">'chr'</span>, <span class="st">''</span>), fontsize<span class="op">=</span><span class="dv">7</span>, verticalalignment<span class="op">=</span><span class="st">'center'</span>, horizontalalignment<span class="op">=</span><span class="st">'right'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>                <span class="co"># h = ax.set_ylabel(chrom)</span></span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a>                <span class="co"># h.set_rotation(0)</span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>                ax.set_yticklabels([])</span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if i == 0:</span></span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     ax.spines['top'].set_visible(True)</span></span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     ax.xaxis.tick_top()</span></span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     ax.xaxis.set_label_position('top') </span></span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     ax.yaxis.set_ticks_position('none')</span></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a>                <span class="co"># elif i == len(ax_list)-1:</span></span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">==</span> <span class="bu">len</span>(<span class="va">self</span>.ax_list)<span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>                    ax.xaxis.tick_bottom()</span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>                    ax.spines[<span class="st">'bottom'</span>].set_visible(<span class="va">True</span>)                    </span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>                    ax.yaxis.set_ticks_position(<span class="st">'none'</span>)</span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>                    ax.yaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>                    ax.set_yticklabels([])</span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>                    ax.set_xticklabels([])</span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>                    ax.xaxis.set_ticks_position(<span class="st">'none'</span>)</span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a>                    ax.yaxis.set_ticks_position(<span class="st">'none'</span>)</span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># ax.spines[['right', 'top', 'left', 'bottom']].set_visible(False)</span></span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw_chromosomes(<span class="va">self</span>, base<span class="op">=</span><span class="fl">0.05</span>, height<span class="op">=</span><span class="fl">0.25</span>, facecolor<span class="op">=</span><span class="st">'#EBEAEA'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.7</span>, <span class="op">**</span>kwargs):</span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_base <span class="op">=</span> base</span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_height <span class="op">=</span> height</span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> plt.rc_context(<span class="va">self</span>.d):</span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.ax_list)):</span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>                chrom <span class="op">=</span> <span class="va">self</span>.chr_names[i]</span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> <span class="va">self</span>.ax_list[i]</span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>                start, end <span class="op">=</span> <span class="dv">0</span>, <span class="va">self</span>.chr_sizes[i]                </span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>                ideogram_base <span class="op">=</span> <span class="va">self</span>.map_y(base, ax)</span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>                ideogram_height <span class="op">=</span> <span class="va">self</span>.map_y(height, ax)</span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>                <span class="co"># draw centromere</span></span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>                cent_start, cent_end <span class="op">=</span> <span class="va">self</span>.centromeres[chrom]</span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>                ymin, ymax <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ax.add_patch(patches.Rectangle((cent_start, ymin), cent_end-cent_start, ymax, </span></span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>                <span class="co">#                            fill=True, color='white',</span></span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>                <span class="co">#                            zorder=1))</span></span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>                xy <span class="op">=</span> [[cent_start, ideogram_base], [cent_start, ideogram_base<span class="op">+</span>ideogram_height], [cent_end, ideogram_base], [cent_end, ideogram_base<span class="op">+</span>ideogram_height]]</span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> ax.add_patch(patches.Polygon(xy, closed<span class="op">=</span><span class="va">True</span>, zorder<span class="op">=</span><span class="dv">2</span>, fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># color='#666666',</span></span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>                                         color<span class="op">=</span><span class="st">'#777777'</span>,</span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a>                                        ))</span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>                <span class="co"># draw chrom</span></span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> ax.add_patch(patches.Rectangle((start, ideogram_base), cent_start<span class="op">-</span>start, ideogram_height, </span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># fill=False,</span></span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>                                           facecolor<span class="op">=</span>facecolor,</span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a>                                           edgecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a>                                           zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a>                                           linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">**</span>kwargs</span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>                                          ))</span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> ax.add_patch(patches.Rectangle((start, ideogram_base), cent_start<span class="op">-</span>start, ideogram_height, </span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># fill=False,</span></span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>                                           facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>                                           edgecolor<span class="op">=</span>edgecolor,</span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>                                           zorder<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a>                                           linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">**</span>kwargs</span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a>                                          )) </span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> ax.add_patch(patches.Rectangle((cent_end, ideogram_base), end<span class="op">-</span>cent_end, ideogram_height, </span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># fill=False,</span></span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a>                                           facecolor<span class="op">=</span>facecolor,</span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a>                                           edgecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a>                                           zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a>                                           linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">**</span>kwargs</span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a>                                          ))</span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> ax.add_patch(patches.Rectangle((cent_end, ideogram_base), end<span class="op">-</span>cent_end, ideogram_height, </span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a>                                           <span class="co"># fill=False,</span></span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a>                                           facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a>                                           edgecolor<span class="op">=</span>edgecolor,</span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a>                                           zorder<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a>                                           linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>                                           <span class="op">**</span>kwargs</span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>                                          ))                   </span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a>                    ideogram_base <span class="op">=</span> <span class="va">self</span>.map_y(base, ax)</span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>                    ideogram_height <span class="op">=</span> <span class="va">self</span>.map_y(height, ax)</span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># draw centromere</span></span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>                    cent_start, cent_end <span class="op">=</span> <span class="va">self</span>.centromeres[chrom]</span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>                    ymin, ymax <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># ax.add_patch(patches.Rectangle((cent_start, ymin), cent_end-cent_start, ymax, </span></span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                            fill=True, color='white',</span></span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#                            zorder=-2))</span></span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a>                    xy <span class="op">=</span> [[cent_start, ideogram_base], [cent_start, ideogram_base<span class="op">+</span>ideogram_height], [cent_end, ideogram_base], [cent_end, ideogram_base<span class="op">+</span>ideogram_height]]</span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>                    g <span class="op">=</span> ax.add_patch(patches.Polygon(xy, closed<span class="op">=</span><span class="va">True</span>, zorder<span class="op">=-</span><span class="dv">1</span>, fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># color='#666666',</span></span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a>                                             color<span class="op">=</span><span class="st">'#777777'</span>,</span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a>                                            ))</span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># draw chrom</span></span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>                    g <span class="op">=</span> ax.add_patch(patches.Rectangle((start, ideogram_base), cent_start<span class="op">-</span>start, ideogram_height, </span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># fill=False,</span></span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a>                                               facecolor<span class="op">=</span>facecolor,</span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>                                               edgecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a>                                               zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a>                                               linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>                                               <span class="op">**</span>kwargs</span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>                                              ))</span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>                    g <span class="op">=</span> ax.add_patch(patches.Rectangle((start, ideogram_base), cent_start<span class="op">-</span>start, ideogram_height, </span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># fill=False,</span></span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a>                                               facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>                                               edgecolor<span class="op">=</span>edgecolor,</span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>                                               zorder<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>                                               linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>                                               <span class="op">**</span>kwargs</span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a>                                              )) </span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>                    g <span class="op">=</span> ax.add_patch(patches.Rectangle((cent_end, ideogram_base), end<span class="op">-</span>cent_end, ideogram_height, </span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># fill=False,</span></span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a>                                               facecolor<span class="op">=</span>facecolor,</span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>                                               edgecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a>                                               zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a>                                               linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a>                                               <span class="op">**</span>kwargs</span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a>                                              ))</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a>                    g <span class="op">=</span> ax.add_patch(patches.Rectangle((cent_end, ideogram_base), end<span class="op">-</span>cent_end, ideogram_height, </span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a>                                               <span class="co"># fill=False,</span></span>
<span id="cb16-342"><a href="#cb16-342" aria-hidden="true" tabindex="-1"></a>                                               facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb16-343"><a href="#cb16-343" aria-hidden="true" tabindex="-1"></a>                                               edgecolor<span class="op">=</span>edgecolor,</span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a>                                               zorder<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a>                                               linewidth<span class="op">=</span>linewidth,</span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a>                                               <span class="op">**</span>kwargs</span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a>                                              ))               </span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_polygons_intersecting(<span class="va">self</span>, a, b):</span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>            polygon <span class="op">=</span> a <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> b</span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i1 <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(polygon.get_points())):</span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>                i2 <span class="op">=</span> (i1 <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(polygon.get_points())</span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a>                p1 <span class="op">=</span> polygon.get_points()[i1]</span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>                p2 <span class="op">=</span> polygon.get_points()[i2]</span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>                normal <span class="op">=</span> Point(p2.y <span class="op">-</span> p1.y, p1.x <span class="op">-</span> p2.x)</span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a>                min_a <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>                max_a <span class="op">=</span> <span class="bu">float</span>(<span class="st">'-inf'</span>)</span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> p <span class="kw">in</span> a.get_points():</span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>                    projected <span class="op">=</span> normal.x <span class="op">*</span> p.x <span class="op">+</span> normal.y <span class="op">*</span> p.y</span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a>                    min_a <span class="op">=</span> <span class="bu">min</span>(min_a, projected)</span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a>                    max_a <span class="op">=</span> <span class="bu">max</span>(max_a, projected)</span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a>                min_b <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a>                max_b <span class="op">=</span> <span class="bu">float</span>(<span class="st">'-inf'</span>)</span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> p <span class="kw">in</span> b.get_points():</span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>                    projected <span class="op">=</span> normal.x <span class="op">*</span> p.x <span class="op">+</span> normal.y <span class="op">*</span> p.y</span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>                    min_b <span class="op">=</span> <span class="bu">min</span>(min_b, projected)</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a>                    max_b <span class="op">=</span> <span class="bu">max</span>(max_b, projected)</span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> max_a <span class="op">&lt;</span> min_b <span class="kw">or</span> max_b <span class="op">&lt;</span> min_a:</span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scaled_y_lim(<span class="va">self</span>, ax):</span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a>        xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-391"><a href="#cb16-391" aria-hidden="true" tabindex="-1"></a>        bbox <span class="op">=</span> ax.get_window_extent().transformed(<span class="va">self</span>.fig.dpi_scale_trans.inverted())</span>
<span id="cb16-392"><a href="#cb16-392" aria-hidden="true" tabindex="-1"></a>        aspect <span class="op">=</span> bbox.height <span class="op">/</span> bbox.width</span>
<span id="cb16-393"><a href="#cb16-393" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-394"><a href="#cb16-394" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, <span class="op">-</span>sub(<span class="op">*</span>xlim) <span class="op">*</span> aspect </span>
<span id="cb16-395"><a href="#cb16-395" aria-hidden="true" tabindex="-1"></a>        <span class="co"># return xlim[0] * self.aspect, xlim[1] * self.aspect</span></span>
<span id="cb16-396"><a href="#cb16-396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-397"><a href="#cb16-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-398"><a href="#cb16-398" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> map_y(<span class="va">self</span>, y, ax, bottom<span class="op">=</span><span class="dv">0</span>, top<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb16-399"><a href="#cb16-399" aria-hidden="true" tabindex="-1"></a>        miny, maxy <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-400"><a href="#cb16-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-401"><a href="#cb16-401" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y <span class="op">*</span> (top <span class="op">-</span> bottom) <span class="op">*</span> (maxy <span class="op">-</span> miny) <span class="op">/</span> (<span class="va">self</span>.ylim[<span class="dv">1</span>] <span class="op">-</span> <span class="va">self</span>.ylim[<span class="dv">0</span>]) <span class="op">+</span> bottom <span class="op">*</span> (maxy <span class="op">-</span> miny)</span>
<span id="cb16-402"><a href="#cb16-402" aria-hidden="true" tabindex="-1"></a>        <span class="co"># zero = -miny</span></span>
<span id="cb16-403"><a href="#cb16-403" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if y &gt;= 0:</span></span>
<span id="cb16-404"><a href="#cb16-404" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     return y * (top - max(bottom, zero)) * (maxy - zero) / (self.ylim[1] - self.ylim[0]) + max(bottom, zero) * (maxy - zero)</span></span>
<span id="cb16-405"><a href="#cb16-405" aria-hidden="true" tabindex="-1"></a>        <span class="co"># else:</span></span>
<span id="cb16-406"><a href="#cb16-406" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     return y * (min(top, zero) - bottom) * (zero - miny) / (self.ylim[1] - self.ylim[0]) + min(top, zero) * (zero - miny)</span></span>
<span id="cb16-407"><a href="#cb16-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-408"><a href="#cb16-408" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-409"><a href="#cb16-409" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw_text(<span class="va">self</span>, x_pos, y_pos, text, ax, color<span class="op">=</span><span class="va">None</span>, y_line_bottom<span class="op">=</span><span class="dv">0</span>, highlight<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-410"><a href="#cb16-410" aria-hidden="true" tabindex="-1"></a>        y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-411"><a href="#cb16-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-412"><a href="#cb16-412" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">bool</span>(color <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>) <span class="op">==</span> <span class="bu">bool</span>(highlight <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</span>
<span id="cb16-413"><a href="#cb16-413" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Do not use color and highlight keyword arguments together"</span>)</span>
<span id="cb16-414"><a href="#cb16-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-415"><a href="#cb16-415" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> highlight <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb16-416"><a href="#cb16-416" aria-hidden="true" tabindex="-1"></a>            text_props <span class="op">=</span> <span class="bu">dict</span>(weight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb16-417"><a href="#cb16-417" aria-hidden="true" tabindex="-1"></a>            linecolor <span class="op">=</span> <span class="st">'lightgray'</span></span>
<span id="cb16-418"><a href="#cb16-418" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">dict</span>:</span>
<span id="cb16-419"><a href="#cb16-419" aria-hidden="true" tabindex="-1"></a>            text_props <span class="op">=</span> highlight</span>
<span id="cb16-420"><a href="#cb16-420" aria-hidden="true" tabindex="-1"></a>            linecolor <span class="op">=</span> <span class="st">'lightgray'</span></span>
<span id="cb16-421"><a href="#cb16-421" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if 'color' in highlight:</span></span>
<span id="cb16-422"><a href="#cb16-422" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     linecolor = highlight['color']</span></span>
<span id="cb16-423"><a href="#cb16-423" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-424"><a href="#cb16-424" aria-hidden="true" tabindex="-1"></a>            text_props <span class="op">=</span> <span class="bu">dict</span>(color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb16-425"><a href="#cb16-425" aria-hidden="true" tabindex="-1"></a>                    fontweight<span class="op">=</span><span class="st">'normal'</span>, <span class="co"># 'normal' | 'bold' | 'heavy' | 'light' | 'ultrabold' | 'ultralight']</span></span>
<span id="cb16-426"><a href="#cb16-426" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># variant = 'small-caps', # [ 'normal' | 'small-caps' ]</span></span>
<span id="cb16-427"><a href="#cb16-427" aria-hidden="true" tabindex="-1"></a>                    fontstyle <span class="op">=</span> <span class="st">'normal'</span>, <span class="co"># [ 'normal' | 'italic' | 'oblique' ]</span></span>
<span id="cb16-428"><a href="#cb16-428" aria-hidden="true" tabindex="-1"></a>                    bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, </span>
<span id="cb16-429"><a href="#cb16-429" aria-hidden="true" tabindex="-1"></a>                              linewidth<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb16-430"><a href="#cb16-430" aria-hidden="true" tabindex="-1"></a>                              fc<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb16-431"><a href="#cb16-431" aria-hidden="true" tabindex="-1"></a>                              alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-432"><a href="#cb16-432" aria-hidden="true" tabindex="-1"></a>                              ec<span class="op">=</span><span class="st">'none'</span>),)</span>
<span id="cb16-433"><a href="#cb16-433" aria-hidden="true" tabindex="-1"></a>            linecolor <span class="op">=</span> <span class="st">'lightgray'</span></span>
<span id="cb16-434"><a href="#cb16-434" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-435"><a href="#cb16-435" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> ax.text(x_pos, y_pos, text, fontsize<span class="op">=</span><span class="va">self</span>.font_size,                     </span>
<span id="cb16-436"><a href="#cb16-436" aria-hidden="true" tabindex="-1"></a>                    rotation<span class="op">=</span><span class="dv">45</span>, zorder<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb16-437"><a href="#cb16-437" aria-hidden="true" tabindex="-1"></a>                    horizontalalignment<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb16-438"><a href="#cb16-438" aria-hidden="true" tabindex="-1"></a>                    verticalalignment<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb16-439"><a href="#cb16-439" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>text_props)</span>
<span id="cb16-440"><a href="#cb16-440" aria-hidden="true" tabindex="-1"></a>        ax.plot((x_pos, x_pos, x_pos<span class="op">+</span>y_unit<span class="op">/</span><span class="dv">10</span>),</span>
<span id="cb16-441"><a href="#cb16-441" aria-hidden="true" tabindex="-1"></a>                (y_line_bottom, y_pos, y_pos<span class="op">+</span>y_unit<span class="op">/</span><span class="dv">10</span>), </span>
<span id="cb16-442"><a href="#cb16-442" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb16-443"><a href="#cb16-443" aria-hidden="true" tabindex="-1"></a>                <span class="co"># color='darkgray', </span></span>
<span id="cb16-444"><a href="#cb16-444" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span><span class="st">'lightgray'</span>,</span>
<span id="cb16-445"><a href="#cb16-445" aria-hidden="true" tabindex="-1"></a>                <span class="co"># alpha=0.3,</span></span>
<span id="cb16-446"><a href="#cb16-446" aria-hidden="true" tabindex="-1"></a>                zorder<span class="op">=-</span><span class="dv">5</span>)</span>
<span id="cb16-447"><a href="#cb16-447" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-448"><a href="#cb16-448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-449"><a href="#cb16-449" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_polygon(<span class="va">self</span>, text:<span class="bu">str</span>, x_pos:<span class="bu">int</span>, y_pos:<span class="bu">float</span>,ax:matplotlib.axes.Axes, pad<span class="op">=</span><span class="dv">0</span>) <span class="op">-&gt;</span> Polygon:</span>
<span id="cb16-450"><a href="#cb16-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-451"><a href="#cb16-451" aria-hidden="true" tabindex="-1"></a>        y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-452"><a href="#cb16-452" aria-hidden="true" tabindex="-1"></a>        <span class="co"># y_unit = -sub(*self.scaled_y_lim(ax)) / -sub(*ax.get_ylim())</span></span>
<span id="cb16-453"><a href="#cb16-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-454"><a href="#cb16-454" aria-hidden="true" tabindex="-1"></a>        y_pos <span class="op">=</span> y_pos <span class="op">*</span> y_unit</span>
<span id="cb16-455"><a href="#cb16-455" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-456"><a href="#cb16-456" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> ax.text(x_pos, y_pos, text, fontsize<span class="op">=</span><span class="va">self</span>.font_size,</span>
<span id="cb16-457"><a href="#cb16-457" aria-hidden="true" tabindex="-1"></a>                    horizontalalignment<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb16-458"><a href="#cb16-458" aria-hidden="true" tabindex="-1"></a>                    verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb16-459"><a href="#cb16-459" aria-hidden="true" tabindex="-1"></a>                    rotation<span class="op">=</span><span class="dv">0</span>, zorder<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb16-460"><a href="#cb16-460" aria-hidden="true" tabindex="-1"></a>                    bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square'</span>, </span>
<span id="cb16-461"><a href="#cb16-461" aria-hidden="true" tabindex="-1"></a>                              fc<span class="op">=</span><span class="st">'none'</span>, ec<span class="op">=</span><span class="st">'red'</span>, pad<span class="op">=</span>pad, alpha<span class="op">=</span><span class="fl">0.4</span>))</span>
<span id="cb16-462"><a href="#cb16-462" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-463"><a href="#cb16-463" aria-hidden="true" tabindex="-1"></a>        transf <span class="op">=</span> ax.transData.inverted()</span>
<span id="cb16-464"><a href="#cb16-464" aria-hidden="true" tabindex="-1"></a>        bb <span class="op">=</span> t.get_window_extent(renderer <span class="op">=</span> <span class="va">self</span>.fig.canvas.get_renderer())</span>
<span id="cb16-465"><a href="#cb16-465" aria-hidden="true" tabindex="-1"></a>        bbt <span class="op">=</span> bb.transformed(transf)</span>
<span id="cb16-466"><a href="#cb16-466" aria-hidden="true" tabindex="-1"></a>        coords <span class="op">=</span> bbt.get_points()</span>
<span id="cb16-467"><a href="#cb16-467" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-468"><a href="#cb16-468" aria-hidden="true" tabindex="-1"></a>        Artist.remove(t)</span>
<span id="cb16-469"><a href="#cb16-469" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-470"><a href="#cb16-470" aria-hidden="true" tabindex="-1"></a>        (x0, y0), (x1, y1) <span class="op">=</span> coords</span>
<span id="cb16-471"><a href="#cb16-471" aria-hidden="true" tabindex="-1"></a>        pad <span class="op">=</span> (y1 <span class="op">-</span> y0)<span class="op">/</span><span class="dv">5</span></span>
<span id="cb16-472"><a href="#cb16-472" aria-hidden="true" tabindex="-1"></a>        coords <span class="op">=</span> np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb16-473"><a href="#cb16-473" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-474"><a href="#cb16-474" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>coords)</span>
<span id="cb16-475"><a href="#cb16-475" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>(x<span class="op">=</span>x, y<span class="op">=</span>y))</span>
<span id="cb16-476"><a href="#cb16-476" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'y'</span>] <span class="op">-=</span> y_pos</span>
<span id="cb16-477"><a href="#cb16-477" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'x'</span>] <span class="op">-=</span> x_pos</span>
<span id="cb16-478"><a href="#cb16-478" aria-hidden="true" tabindex="-1"></a>        dfx <span class="op">=</span> df[<span class="st">'x'</span>]<span class="op">*</span>math.cos(math.radians(<span class="dv">45</span>))<span class="op">-</span>df[<span class="st">'y'</span>]<span class="op">*</span>math.sin(math.radians(<span class="dv">45</span>))</span>
<span id="cb16-479"><a href="#cb16-479" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'y'</span>] <span class="op">=</span> df[<span class="st">'x'</span>]<span class="op">*</span>math.sin(math.radians(<span class="dv">45</span>))<span class="op">+</span>df[<span class="st">'y'</span>]<span class="op">*</span>math.cos(math.radians(<span class="dv">45</span>))</span>
<span id="cb16-480"><a href="#cb16-480" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'x'</span>] <span class="op">=</span> dfx</span>
<span id="cb16-481"><a href="#cb16-481" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'y'</span>] <span class="op">+=</span> y_pos</span>
<span id="cb16-482"><a href="#cb16-482" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'x'</span>] <span class="op">+=</span> x_pos</span>
<span id="cb16-483"><a href="#cb16-483" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-484"><a href="#cb16-484" aria-hidden="true" tabindex="-1"></a>        coords <span class="op">=</span> np.array(<span class="bu">list</span>(<span class="bu">zip</span>(df.x, df.y)))</span>
<span id="cb16-485"><a href="#cb16-485" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-486"><a href="#cb16-486" aria-hidden="true" tabindex="-1"></a>        x_pos, y_pos <span class="op">=</span> df[<span class="st">'x'</span>][<span class="dv">0</span>] <span class="op">-</span> (df[<span class="st">'x'</span>][<span class="dv">0</span>] <span class="op">-</span> df[<span class="st">'x'</span>][<span class="dv">1</span>]), df[<span class="st">'y'</span>][<span class="dv">0</span>]</span>
<span id="cb16-487"><a href="#cb16-487" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-488"><a href="#cb16-488" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'x'</span>] <span class="op">=</span> df.x <span class="op">+</span> np.array([<span class="op">-</span>pad, <span class="op">-</span>pad, pad, pad])</span>
<span id="cb16-489"><a href="#cb16-489" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">+</span> np.array([<span class="op">-</span>pad, pad, pad, <span class="op">-</span>pad])</span>
<span id="cb16-490"><a href="#cb16-490" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-491"><a href="#cb16-491" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x_pos, y_pos, Polygon([Point(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(df.x, df.y)])</span>
<span id="cb16-492"><a href="#cb16-492" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-493"><a href="#cb16-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-494"><a href="#cb16-494" aria-hidden="true" tabindex="-1"></a>    <span class="co"># def add_labels(self, data, labels='name', chrom='chrom', x='pos'):</span></span>
<span id="cb16-495"><a href="#cb16-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_labels(<span class="va">self</span>, annot, y0<span class="op">=</span><span class="va">None</span>, y1<span class="op">=</span><span class="va">None</span>, bold<span class="op">=</span>[], italic<span class="op">=</span>[], colored<span class="op">=</span>[], framed<span class="op">=</span>[], filled<span class="op">=</span>[], pad<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb16-496"><a href="#cb16-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-497"><a href="#cb16-497" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y0 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-498"><a href="#cb16-498" aria-hidden="true" tabindex="-1"></a>            y0 <span class="op">=</span> <span class="va">self</span>.ideogram_base <span class="op">+</span> <span class="va">self</span>.ideogram_height</span>
<span id="cb16-499"><a href="#cb16-499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y1 <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-500"><a href="#cb16-500" aria-hidden="true" tabindex="-1"></a>            y1 <span class="op">=</span> <span class="va">self</span>.ideogram_base <span class="op">+</span> <span class="va">self</span>.ideogram_height <span class="op">+</span> <span class="va">self</span>.min_stick_height</span>
<span id="cb16-501"><a href="#cb16-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-502"><a href="#cb16-502" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-503"><a href="#cb16-503" aria-hidden="true" tabindex="-1"></a>        highlight <span class="op">=</span> defaultdict(<span class="bu">dict</span>)</span>
<span id="cb16-504"><a href="#cb16-504" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> bold:</span>
<span id="cb16-505"><a href="#cb16-505" aria-hidden="true" tabindex="-1"></a>            highlight[gene].update(<span class="bu">dict</span>(weight<span class="op">=</span><span class="st">'bold'</span>))</span>
<span id="cb16-506"><a href="#cb16-506" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> italic:</span>
<span id="cb16-507"><a href="#cb16-507" aria-hidden="true" tabindex="-1"></a>            highlight[gene].update(<span class="bu">dict</span>(style<span class="op">=</span><span class="st">'italic'</span>))</span>
<span id="cb16-508"><a href="#cb16-508" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> colored:</span>
<span id="cb16-509"><a href="#cb16-509" aria-hidden="true" tabindex="-1"></a>            highlight[gene].update(<span class="bu">dict</span>(color<span class="op">=</span><span class="st">'red'</span>))</span>
<span id="cb16-510"><a href="#cb16-510" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> framed:</span>
<span id="cb16-511"><a href="#cb16-511" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'bbox'</span> <span class="kw">not</span> <span class="kw">in</span> highlight[gene]:</span>
<span id="cb16-512"><a href="#cb16-512" aria-hidden="true" tabindex="-1"></a>                highlight[gene][<span class="st">'bbox'</span>] <span class="op">=</span> {}</span>
<span id="cb16-513"><a href="#cb16-513" aria-hidden="true" tabindex="-1"></a>            highlight[gene][<span class="st">'bbox'</span>].update(<span class="bu">dict</span>(edgecolor<span class="op">=</span><span class="st">'black'</span>, pad<span class="op">=</span>pad, linewidth<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb16-514"><a href="#cb16-514" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> filled:</span>
<span id="cb16-515"><a href="#cb16-515" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'bbox'</span> <span class="kw">not</span> <span class="kw">in</span> highlight[gene]:</span>
<span id="cb16-516"><a href="#cb16-516" aria-hidden="true" tabindex="-1"></a>                highlight[gene][<span class="st">'bbox'</span>] <span class="op">=</span> {}</span>
<span id="cb16-517"><a href="#cb16-517" aria-hidden="true" tabindex="-1"></a>            highlight[gene][<span class="st">'bbox'</span>].update(<span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, pad<span class="op">=</span>pad))</span>
<span id="cb16-518"><a href="#cb16-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-519"><a href="#cb16-519" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> gene <span class="kw">in</span> highlight:</span>
<span id="cb16-520"><a href="#cb16-520" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'bbox'</span> <span class="kw">in</span> highlight[gene]:</span>
<span id="cb16-521"><a href="#cb16-521" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'edgecolor'</span> <span class="kw">not</span> <span class="kw">in</span> highlight[gene][<span class="st">'bbox'</span>]:</span>
<span id="cb16-522"><a href="#cb16-522" aria-hidden="true" tabindex="-1"></a>                    highlight[gene][<span class="st">'bbox'</span>][<span class="st">'edgecolor'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb16-523"><a href="#cb16-523" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'facecolor'</span> <span class="kw">not</span> <span class="kw">in</span> highlight[gene][<span class="st">'bbox'</span>]:</span>
<span id="cb16-524"><a href="#cb16-524" aria-hidden="true" tabindex="-1"></a>                    highlight[gene][<span class="st">'bbox'</span>][<span class="st">'facecolor'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb16-525"><a href="#cb16-525" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-526"><a href="#cb16-526" aria-hidden="true" tabindex="-1"></a>        chrom_annot <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb16-527"><a href="#cb16-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> a <span class="kw">in</span> annot:</span>
<span id="cb16-528"><a href="#cb16-528" aria-hidden="true" tabindex="-1"></a>            chrom_annot[a[<span class="dv">0</span>]].append(a[<span class="dv">1</span>:])</span>
<span id="cb16-529"><a href="#cb16-529" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-530"><a href="#cb16-530" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chrom, annot <span class="kw">in</span> chrom_annot.items():</span>
<span id="cb16-531"><a href="#cb16-531" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> <span class="va">self</span>.chr_axes[chrom]</span>
<span id="cb16-532"><a href="#cb16-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-533"><a href="#cb16-533" aria-hidden="true" tabindex="-1"></a>            annot <span class="op">=</span> <span class="bu">sorted</span>(annot, reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-534"><a href="#cb16-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-535"><a href="#cb16-535" aria-hidden="true" tabindex="-1"></a>            y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-536"><a href="#cb16-536" aria-hidden="true" tabindex="-1"></a>            nudge <span class="op">=</span> <span class="fl">0.01</span> <span class="op">*</span> y_unit</span>
<span id="cb16-537"><a href="#cb16-537" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-538"><a href="#cb16-538" aria-hidden="true" tabindex="-1"></a>            polybuff <span class="op">=</span> []</span>
<span id="cb16-539"><a href="#cb16-539" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> pos, name, <span class="op">*</span>args <span class="kw">in</span> annot:</span>
<span id="cb16-540"><a href="#cb16-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-541"><a href="#cb16-541" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">list</span> <span class="kw">or</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">set</span>:</span>
<span id="cb16-542"><a href="#cb16-542" aria-hidden="true" tabindex="-1"></a>                    hl <span class="op">=</span> name <span class="kw">in</span> highlight</span>
<span id="cb16-543"><a href="#cb16-543" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">dict</span> <span class="kw">or</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> defaultdict:</span>
<span id="cb16-544"><a href="#cb16-544" aria-hidden="true" tabindex="-1"></a>                    hl <span class="op">=</span> highlight[name]</span>
<span id="cb16-545"><a href="#cb16-545" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-546"><a href="#cb16-546" aria-hidden="true" tabindex="-1"></a>                    hl <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-547"><a href="#cb16-547" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-548"><a href="#cb16-548" aria-hidden="true" tabindex="-1"></a>                x, y, poly <span class="op">=</span> <span class="va">self</span>.get_polygon(name, pos, y1, ax, pad<span class="op">=</span>pad)</span>
<span id="cb16-549"><a href="#cb16-549" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="bu">any</span>(<span class="va">self</span>.is_polygons_intersecting(poly, p) <span class="cf">for</span> p <span class="kw">in</span> polybuff):</span>
<span id="cb16-550"><a href="#cb16-550" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">+=</span> nudge</span>
<span id="cb16-551"><a href="#cb16-551" aria-hidden="true" tabindex="-1"></a>                    poly.nudge_y(nudge)</span>
<span id="cb16-552"><a href="#cb16-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-553"><a href="#cb16-553" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.draw_text(x, y, name, ax, <span class="op">*</span>args, y_line_bottom<span class="op">=</span>y0<span class="op">*</span>y_unit, highlight<span class="op">=</span>hl)</span>
<span id="cb16-554"><a href="#cb16-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-555"><a href="#cb16-555" aria-hidden="true" tabindex="-1"></a>                polybuff.append(poly)</span>
<span id="cb16-556"><a href="#cb16-556" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(polybuff) <span class="op">&gt;</span> <span class="dv">40</span>:</span>
<span id="cb16-557"><a href="#cb16-557" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">del</span> polybuff[<span class="dv">0</span>]        </span>
<span id="cb16-558"><a href="#cb16-558" aria-hidden="true" tabindex="-1"></a>            z <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb16-559"><a href="#cb16-559" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, t <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">reversed</span>(ax.texts)):</span>
<span id="cb16-560"><a href="#cb16-560" aria-hidden="true" tabindex="-1"></a>                t.set_zorder(z<span class="op">+</span>i)</span>
<span id="cb16-561"><a href="#cb16-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-562"><a href="#cb16-562" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> zoom, ax <span class="kw">in</span> <span class="bu">zip</span>(<span class="va">self</span>.zooms, <span class="va">self</span>.zoom_axes):</span>
<span id="cb16-563"><a href="#cb16-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-564"><a href="#cb16-564" aria-hidden="true" tabindex="-1"></a>                y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-565"><a href="#cb16-565" aria-hidden="true" tabindex="-1"></a>                nudge <span class="op">=</span> <span class="fl">0.01</span> <span class="op">*</span> y_unit</span>
<span id="cb16-566"><a href="#cb16-566" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-567"><a href="#cb16-567" aria-hidden="true" tabindex="-1"></a>                zoom_polybuff <span class="op">=</span> []</span>
<span id="cb16-568"><a href="#cb16-568" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> pos, name, <span class="op">*</span>args <span class="kw">in</span> annot:</span>
<span id="cb16-569"><a href="#cb16-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-570"><a href="#cb16-570" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">list</span> <span class="kw">or</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">set</span>:</span>
<span id="cb16-571"><a href="#cb16-571" aria-hidden="true" tabindex="-1"></a>                        hl <span class="op">=</span> name <span class="kw">in</span> highlight</span>
<span id="cb16-572"><a href="#cb16-572" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> <span class="bu">dict</span> <span class="kw">or</span> <span class="bu">type</span>(highlight) <span class="kw">is</span> defaultdict:</span>
<span id="cb16-573"><a href="#cb16-573" aria-hidden="true" tabindex="-1"></a>                        hl <span class="op">=</span> highlight[name]</span>
<span id="cb16-574"><a href="#cb16-574" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb16-575"><a href="#cb16-575" aria-hidden="true" tabindex="-1"></a>                        hl <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-576"><a href="#cb16-576" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb16-577"><a href="#cb16-577" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> pos <span class="op">&gt;=</span> zoom[<span class="dv">0</span>] <span class="kw">and</span> pos <span class="op">&lt;</span> zoom[<span class="dv">1</span>]:</span>
<span id="cb16-578"><a href="#cb16-578" aria-hidden="true" tabindex="-1"></a>                        x, y, poly <span class="op">=</span> <span class="va">self</span>.get_polygon(name, pos, y1, ax)</span>
<span id="cb16-579"><a href="#cb16-579" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">while</span> <span class="bu">any</span>(<span class="va">self</span>.is_polygons_intersecting(poly, p) <span class="cf">for</span> p <span class="kw">in</span> zoom_polybuff):</span>
<span id="cb16-580"><a href="#cb16-580" aria-hidden="true" tabindex="-1"></a>                            y <span class="op">+=</span> nudge</span>
<span id="cb16-581"><a href="#cb16-581" aria-hidden="true" tabindex="-1"></a>                            poly.nudge_y(nudge)</span>
<span id="cb16-582"><a href="#cb16-582" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.draw_text(x, y, name, ax, <span class="op">*</span>args, y_line_bottom<span class="op">=</span>y0<span class="op">*</span>y_unit, highlight<span class="op">=</span>hl)</span>
<span id="cb16-583"><a href="#cb16-583" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-584"><a href="#cb16-584" aria-hidden="true" tabindex="-1"></a>                        zoom_polybuff.append(poly)</span>
<span id="cb16-585"><a href="#cb16-585" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">len</span>(zoom_polybuff) <span class="op">&gt;</span> <span class="dv">20</span>:</span>
<span id="cb16-586"><a href="#cb16-586" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">del</span> zoom_polybuff[<span class="dv">0</span>]        </span>
<span id="cb16-587"><a href="#cb16-587" aria-hidden="true" tabindex="-1"></a>                z <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb16-588"><a href="#cb16-588" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i, t <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">reversed</span>(ax.texts)):</span>
<span id="cb16-589"><a href="#cb16-589" aria-hidden="true" tabindex="-1"></a>                    t.set_zorder(z<span class="op">+</span>i)</span>
<span id="cb16-590"><a href="#cb16-590" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb16-591"><a href="#cb16-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-592"><a href="#cb16-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-593"><a href="#cb16-593" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_segments(<span class="va">self</span>, annot, base<span class="op">=</span><span class="va">None</span>, height<span class="op">=</span><span class="va">None</span>, label<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb16-594"><a href="#cb16-594" aria-hidden="true" tabindex="-1"></a>                    min_visible_width:<span class="bu">int</span><span class="op">=</span><span class="dv">200000</span>, <span class="op">**</span>kwargs):</span>
<span id="cb16-595"><a href="#cb16-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-596"><a href="#cb16-596" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'facecolor'</span> <span class="kw">not</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-597"><a href="#cb16-597" aria-hidden="true" tabindex="-1"></a>            kwargs[<span class="st">'facecolor'</span>] <span class="op">=</span> <span class="st">'black'</span></span>
<span id="cb16-598"><a href="#cb16-598" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'edgecolor'</span> <span class="kw">not</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-599"><a href="#cb16-599" aria-hidden="true" tabindex="-1"></a>            kwargs[<span class="st">'edgecolor'</span>] <span class="op">=</span> <span class="st">'none'</span></span>
<span id="cb16-600"><a href="#cb16-600" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-601"><a href="#cb16-601" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-602"><a href="#cb16-602" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.legend_handles.append(Patch(facecolor<span class="op">=</span>kwargs[<span class="st">'facecolor'</span>], edgecolor<span class="op">=</span>kwargs[<span class="st">'edgecolor'</span>],label<span class="op">=</span>label))</span>
<span id="cb16-603"><a href="#cb16-603" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-604"><a href="#cb16-604" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> base <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-605"><a href="#cb16-605" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> <span class="va">self</span>.ideogram_base</span>
<span id="cb16-606"><a href="#cb16-606" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> height <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-607"><a href="#cb16-607" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> <span class="va">self</span>.ideogram_height            </span>
<span id="cb16-608"><a href="#cb16-608" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-609"><a href="#cb16-609" aria-hidden="true" tabindex="-1"></a>        chrom_annot <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb16-610"><a href="#cb16-610" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> a <span class="kw">in</span> annot:</span>
<span id="cb16-611"><a href="#cb16-611" aria-hidden="true" tabindex="-1"></a>            chrom_annot[a[<span class="dv">0</span>]].append(a[<span class="dv">1</span>:])</span>
<span id="cb16-612"><a href="#cb16-612" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-613"><a href="#cb16-613" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chrom, annot <span class="kw">in</span> chrom_annot.items():</span>
<span id="cb16-614"><a href="#cb16-614" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> <span class="va">self</span>.chr_axes[chrom]</span>
<span id="cb16-615"><a href="#cb16-615" aria-hidden="true" tabindex="-1"></a>            annot <span class="op">=</span> <span class="bu">sorted</span>(annot, reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-616"><a href="#cb16-616" aria-hidden="true" tabindex="-1"></a>            y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-617"><a href="#cb16-617" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> start, end <span class="kw">in</span> annot:</span>
<span id="cb16-618"><a href="#cb16-618" aria-hidden="true" tabindex="-1"></a>                scaled_base <span class="op">=</span> base <span class="op">*</span> y_unit</span>
<span id="cb16-619"><a href="#cb16-619" aria-hidden="true" tabindex="-1"></a>                scaled_height <span class="op">=</span> height <span class="op">*</span> y_unit                </span>
<span id="cb16-620"><a href="#cb16-620" aria-hidden="true" tabindex="-1"></a>                width <span class="op">=</span> end <span class="op">-</span> start</span>
<span id="cb16-621"><a href="#cb16-621" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> width <span class="op">&lt;</span> min_visible_width:</span>
<span id="cb16-622"><a href="#cb16-622" aria-hidden="true" tabindex="-1"></a>                    start <span class="op">-=</span> min_visible_width<span class="op">/</span><span class="dv">2</span></span>
<span id="cb16-623"><a href="#cb16-623" aria-hidden="true" tabindex="-1"></a>                    width <span class="op">+=</span> min_visible_width</span>
<span id="cb16-624"><a href="#cb16-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-625"><a href="#cb16-625" aria-hidden="true" tabindex="-1"></a>                rect <span class="op">=</span> patches.Rectangle((start, scaled_base), width, scaled_height, linewidth<span class="op">=</span><span class="dv">1</span>, zorder<span class="op">=</span><span class="dv">3</span>, <span class="op">**</span>kwargs)</span>
<span id="cb16-626"><a href="#cb16-626" aria-hidden="true" tabindex="-1"></a>                ax.add_patch(rect)    </span>
<span id="cb16-627"><a href="#cb16-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-628"><a href="#cb16-628" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> zoom_ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-629"><a href="#cb16-629" aria-hidden="true" tabindex="-1"></a>                    zoom_y_unit <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.scaled_y_lim(zoom_ax)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-630"><a href="#cb16-630" aria-hidden="true" tabindex="-1"></a>                    zoom_scaled_base <span class="op">=</span> base <span class="op">*</span> zoom_y_unit</span>
<span id="cb16-631"><a href="#cb16-631" aria-hidden="true" tabindex="-1"></a>                    zoom_scaled_height <span class="op">=</span> height <span class="op">*</span> zoom_y_unit                      </span>
<span id="cb16-632"><a href="#cb16-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-633"><a href="#cb16-633" aria-hidden="true" tabindex="-1"></a>                    rect <span class="op">=</span> patches.Rectangle((start, zoom_scaled_base), width, zoom_scaled_height, linewidth<span class="op">=</span><span class="dv">1</span>, zorder<span class="op">=</span><span class="dv">3</span>, <span class="op">**</span>kwargs)</span>
<span id="cb16-634"><a href="#cb16-634" aria-hidden="true" tabindex="-1"></a>                    zoom_ax.add_patch(rect)    </span>
<span id="cb16-635"><a href="#cb16-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-636"><a href="#cb16-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-637"><a href="#cb16-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-638"><a href="#cb16-638" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_vlines(<span class="va">self</span>, step<span class="op">=</span><span class="dv">1000000</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.1</span>, zorder<span class="op">=</span><span class="dv">100</span>, <span class="op">**</span>kwargs):</span>
<span id="cb16-639"><a href="#cb16-639" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.ax_list):</span>
<span id="cb16-640"><a href="#cb16-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-641"><a href="#cb16-641" aria-hidden="true" tabindex="-1"></a>            s, e <span class="op">=</span> <span class="va">self</span>.centromeres[<span class="va">self</span>.chr_names[i]]</span>
<span id="cb16-642"><a href="#cb16-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-643"><a href="#cb16-643" aria-hidden="true" tabindex="-1"></a>            ymin <span class="op">=</span> <span class="va">self</span>.map_y(<span class="va">self</span>.ideogram_base, ax)        </span>
<span id="cb16-644"><a href="#cb16-644" aria-hidden="true" tabindex="-1"></a>            ymax <span class="op">=</span> <span class="va">self</span>.map_y(<span class="va">self</span>.ideogram_base<span class="op">+</span><span class="va">self</span>.ideogram_height, ax)</span>
<span id="cb16-645"><a href="#cb16-645" aria-hidden="true" tabindex="-1"></a>            ax.vlines([x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="va">self</span>.chr_sizes[i], step) <span class="cf">if</span> x <span class="op">&lt;</span> s <span class="kw">or</span> x <span class="op">&gt;</span> e], </span>
<span id="cb16-646"><a href="#cb16-646" aria-hidden="true" tabindex="-1"></a>                      ymin<span class="op">=</span>ymin, ymax<span class="op">=</span>ymax, linewidth<span class="op">=</span>linewidth, color<span class="op">=</span>color, zorder<span class="op">=</span>zorder, <span class="op">**</span>kwargs)</span>
<span id="cb16-647"><a href="#cb16-647" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-648"><a href="#cb16-648" aria-hidden="true" tabindex="-1"></a>                ymin <span class="op">=</span> <span class="va">self</span>.map_y(<span class="va">self</span>.ideogram_base, ax)        </span>
<span id="cb16-649"><a href="#cb16-649" aria-hidden="true" tabindex="-1"></a>                ymax <span class="op">=</span> <span class="va">self</span>.map_y(<span class="va">self</span>.ideogram_base<span class="op">+</span><span class="va">self</span>.ideogram_height, ax)</span>
<span id="cb16-650"><a href="#cb16-650" aria-hidden="true" tabindex="-1"></a>                ax.vlines([x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="va">self</span>.chr_sizes[i], step) <span class="cf">if</span> x <span class="op">&lt;</span> s <span class="kw">or</span> x <span class="op">&gt;</span> e], </span>
<span id="cb16-651"><a href="#cb16-651" aria-hidden="true" tabindex="-1"></a>                          ymin<span class="op">=</span>ymin, ymax<span class="op">=</span>ymax, linewidth<span class="op">=</span>linewidth, color<span class="op">=</span>color, zorder<span class="op">=</span>zorder, <span class="op">**</span>kwargs)</span>
<span id="cb16-652"><a href="#cb16-652" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-653"><a href="#cb16-653" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-654"><a href="#cb16-654" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co"> rename yaxis to data_scaling or something or use offset and scale or offset and height</span></span>
<span id="cb16-655"><a href="#cb16-655" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> map_method(<span class="va">self</span>, fun, data<span class="op">=</span><span class="va">None</span>, chrom_col<span class="op">=</span><span class="st">'chrom'</span>, yaxis<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="op">**</span>kwargs):</span>
<span id="cb16-656"><a href="#cb16-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-657"><a href="#cb16-657" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> method_not_found(): <span class="co"># just in case we dont have the function</span></span>
<span id="cb16-658"><a href="#cb16-658" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'No Function '</span><span class="op">+</span>fun<span class="op">+</span><span class="st">' Found!'</span>)</span>
<span id="cb16-659"><a href="#cb16-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-660"><a href="#cb16-660" aria-hidden="true" tabindex="-1"></a>        grouped <span class="op">=</span> data.groupby(chrom_col, observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-661"><a href="#cb16-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chrom, group <span class="kw">in</span> grouped:</span>
<span id="cb16-662"><a href="#cb16-662" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> <span class="va">self</span>.chr_axes[chrom]</span>
<span id="cb16-663"><a href="#cb16-663" aria-hidden="true" tabindex="-1"></a>            bottom, top <span class="op">=</span> yaxis            </span>
<span id="cb16-664"><a href="#cb16-664" aria-hidden="true" tabindex="-1"></a>            scaled_y_lim <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-665"><a href="#cb16-665" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'ylim'</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-666"><a href="#cb16-666" aria-hidden="true" tabindex="-1"></a>                dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span>ylim)</span>
<span id="cb16-667"><a href="#cb16-667" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb16-668"><a href="#cb16-668" aria-hidden="true" tabindex="-1"></a>                dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-669"><a href="#cb16-669" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> group.reset_index() <span class="co"># create independent dataframe</span></span>
<span id="cb16-670"><a href="#cb16-670" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'y'</span>] <span class="op">-=</span> df.y.<span class="bu">min</span>()</span>
<span id="cb16-671"><a href="#cb16-671" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'y'</span>] <span class="op">/=</span> df.y.<span class="bu">max</span>()</span>
<span id="cb16-672"><a href="#cb16-672" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> ((top<span class="op">-</span>bottom) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">+</span> bottom <span class="op">/</span>  <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)</span>
<span id="cb16-673"><a href="#cb16-673" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> df.x</span>
<span id="cb16-674"><a href="#cb16-674" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> df.y</span>
<span id="cb16-675"><a href="#cb16-675" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'x'</span> <span class="kw">in</span> kwargs: <span class="kw">del</span> kwargs[<span class="st">'x'</span>]</span>
<span id="cb16-676"><a href="#cb16-676" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'y'</span> <span class="kw">in</span> kwargs: <span class="kw">del</span> kwargs[<span class="st">'y'</span>]                </span>
<span id="cb16-677"><a href="#cb16-677" aria-hidden="true" tabindex="-1"></a>            fun_name <span class="op">=</span> fun.<span class="va">__name__</span></span>
<span id="cb16-678"><a href="#cb16-678" aria-hidden="true" tabindex="-1"></a>            method <span class="op">=</span> <span class="bu">getattr</span>(ax, fun_name, method_not_found) </span>
<span id="cb16-679"><a href="#cb16-679" aria-hidden="true" tabindex="-1"></a>            g <span class="op">=</span> method(x, y, <span class="op">**</span>kwargs)</span>
<span id="cb16-680"><a href="#cb16-680" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-681"><a href="#cb16-681" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-682"><a href="#cb16-682" aria-hidden="true" tabindex="-1"></a>                scaled_y_lim <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-683"><a href="#cb16-683" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'ylim'</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-684"><a href="#cb16-684" aria-hidden="true" tabindex="-1"></a>                    dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span>ylim)</span>
<span id="cb16-685"><a href="#cb16-685" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-686"><a href="#cb16-686" aria-hidden="true" tabindex="-1"></a>                    dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-687"><a href="#cb16-687" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> group.reset_index() <span class="co"># create independent dataframe</span></span>
<span id="cb16-688"><a href="#cb16-688" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">-=</span> df.y.<span class="bu">min</span>()</span>
<span id="cb16-689"><a href="#cb16-689" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">/=</span> df.y.<span class="bu">max</span>()</span>
<span id="cb16-690"><a href="#cb16-690" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> ((top<span class="op">-</span>bottom) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">+</span> bottom <span class="op">/</span>  <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)</span>
<span id="cb16-691"><a href="#cb16-691" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> df.x</span>
<span id="cb16-692"><a href="#cb16-692" aria-hidden="true" tabindex="-1"></a>                y <span class="op">=</span> df.y</span>
<span id="cb16-693"><a href="#cb16-693" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'x'</span> <span class="kw">in</span> kwargs: <span class="kw">del</span> kwargs[<span class="st">'x'</span>]</span>
<span id="cb16-694"><a href="#cb16-694" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'y'</span> <span class="kw">in</span> kwargs: <span class="kw">del</span> kwargs[<span class="st">'y'</span>]   </span>
<span id="cb16-695"><a href="#cb16-695" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-696"><a href="#cb16-696" aria-hidden="true" tabindex="-1"></a>                method <span class="op">=</span> <span class="bu">getattr</span>(ax, fun_name, method_not_found) </span>
<span id="cb16-697"><a href="#cb16-697" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> method(x, y, <span class="op">**</span>kwargs)</span>
<span id="cb16-698"><a href="#cb16-698" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-699"><a href="#cb16-699" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb16-700"><a href="#cb16-700" aria-hidden="true" tabindex="-1"></a>                    ax.get_legend().remove()</span>
<span id="cb16-701"><a href="#cb16-701" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span>:</span>
<span id="cb16-702"><a href="#cb16-702" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">pass</span></span>
<span id="cb16-703"><a href="#cb16-703" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">''</span>)</span>
<span id="cb16-704"><a href="#cb16-704" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">''</span>)</span>
<span id="cb16-705"><a href="#cb16-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-706"><a href="#cb16-706" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-707"><a href="#cb16-707" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> map_fun(<span class="va">self</span>, fun, data<span class="op">=</span><span class="va">None</span>, chrom_col<span class="op">=</span><span class="st">'chrom'</span>, yaxis<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb16-708"><a href="#cb16-708" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-709"><a href="#cb16-709" aria-hidden="true" tabindex="-1"></a>        grouped <span class="op">=</span> data.groupby(chrom_col, observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-710"><a href="#cb16-710" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chrom, group <span class="kw">in</span> grouped:</span>
<span id="cb16-711"><a href="#cb16-711" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> <span class="va">self</span>.chr_axes[chrom]</span>
<span id="cb16-712"><a href="#cb16-712" aria-hidden="true" tabindex="-1"></a>            scaled_y_lim <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-713"><a href="#cb16-713" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'ylim'</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-714"><a href="#cb16-714" aria-hidden="true" tabindex="-1"></a>                dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span>ylim)</span>
<span id="cb16-715"><a href="#cb16-715" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb16-716"><a href="#cb16-716" aria-hidden="true" tabindex="-1"></a>                dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-717"><a href="#cb16-717" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> group.copy()</span>
<span id="cb16-718"><a href="#cb16-718" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> yaxis <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-719"><a href="#cb16-719" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-720"><a href="#cb16-720" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb16-721"><a href="#cb16-721" aria-hidden="true" tabindex="-1"></a>                bottom, top <span class="op">=</span> yaxis</span>
<span id="cb16-722"><a href="#cb16-722" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">-=</span> df.y.<span class="bu">min</span>()</span>
<span id="cb16-723"><a href="#cb16-723" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">/=</span> df.y.<span class="bu">max</span>()</span>
<span id="cb16-724"><a href="#cb16-724" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> ((top<span class="op">-</span>bottom) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">+</span> bottom <span class="op">/</span>  <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)</span>
<span id="cb16-725"><a href="#cb16-725" aria-hidden="true" tabindex="-1"></a>            g <span class="op">=</span> fun(df, ax<span class="op">=</span>ax, <span class="op">**</span>kwargs)</span>
<span id="cb16-726"><a href="#cb16-726" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-727"><a href="#cb16-727" aria-hidden="true" tabindex="-1"></a>                scaled_y_lim <span class="op">=</span> ax.get_ylim()</span>
<span id="cb16-728"><a href="#cb16-728" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'ylim'</span> <span class="kw">in</span> kwargs:</span>
<span id="cb16-729"><a href="#cb16-729" aria-hidden="true" tabindex="-1"></a>                    dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span>ylim)</span>
<span id="cb16-730"><a href="#cb16-730" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-731"><a href="#cb16-731" aria-hidden="true" tabindex="-1"></a>                    dy <span class="op">=</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-732"><a href="#cb16-732" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> group.copy()</span>
<span id="cb16-733"><a href="#cb16-733" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> yaxis <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-734"><a href="#cb16-734" aria-hidden="true" tabindex="-1"></a>                    df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim)</span>
<span id="cb16-735"><a href="#cb16-735" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb16-736"><a href="#cb16-736" aria-hidden="true" tabindex="-1"></a>                    bottom, top <span class="op">=</span> yaxis</span>
<span id="cb16-737"><a href="#cb16-737" aria-hidden="true" tabindex="-1"></a>                    df[<span class="st">'y'</span>] <span class="op">-=</span> df.y.<span class="bu">min</span>()</span>
<span id="cb16-738"><a href="#cb16-738" aria-hidden="true" tabindex="-1"></a>                    df[<span class="st">'y'</span>] <span class="op">/=</span> df.y.<span class="bu">max</span>()</span>
<span id="cb16-739"><a href="#cb16-739" aria-hidden="true" tabindex="-1"></a>                    df[<span class="st">'y'</span>] <span class="op">=</span> df.y <span class="op">*</span> ((top<span class="op">-</span>bottom) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)) <span class="op">/</span> <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">+</span> bottom <span class="op">/</span>  <span class="op">-</span>sub(<span class="op">*</span><span class="va">self</span>.ylim) <span class="op">*</span> <span class="op">-</span>sub(<span class="op">*</span>scaled_y_lim)</span>
<span id="cb16-740"><a href="#cb16-740" aria-hidden="true" tabindex="-1"></a>                g <span class="op">=</span> fun(df, ax<span class="op">=</span>ax, <span class="op">**</span>kwargs)</span>
<span id="cb16-741"><a href="#cb16-741" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb16-742"><a href="#cb16-742" aria-hidden="true" tabindex="-1"></a>                    ax.get_legend().remove()</span>
<span id="cb16-743"><a href="#cb16-743" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span>:</span>
<span id="cb16-744"><a href="#cb16-744" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">pass</span>                               </span>
<span id="cb16-745"><a href="#cb16-745" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">''</span>)</span>
<span id="cb16-746"><a href="#cb16-746" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">''</span>)</span>
<span id="cb16-747"><a href="#cb16-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-748"><a href="#cb16-748" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> legend(<span class="va">self</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), frameon<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>kwargs):</span>
<span id="cb16-749"><a href="#cb16-749" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.ax_list:</span>
<span id="cb16-750"><a href="#cb16-750" aria-hidden="true" tabindex="-1"></a>            handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb16-751"><a href="#cb16-751" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.legend_handles:</span>
<span id="cb16-752"><a href="#cb16-752" aria-hidden="true" tabindex="-1"></a>                handles <span class="op">=</span> <span class="va">self</span>.legend_handles <span class="op">+</span> handles</span>
<span id="cb16-753"><a href="#cb16-753" aria-hidden="true" tabindex="-1"></a>            ax.legend(handles<span class="op">=</span>handles, loc<span class="op">=</span>loc, bbox_to_anchor<span class="op">=</span>bbox_to_anchor, frameon<span class="op">=</span>frameon, <span class="op">**</span>kwargs)</span>
<span id="cb16-754"><a href="#cb16-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-755"><a href="#cb16-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-756"><a href="#cb16-756" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _horizon(<span class="va">self</span>, row, i, cut):</span>
<span id="cb16-757"><a href="#cb16-757" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-758"><a href="#cb16-758" aria-hidden="true" tabindex="-1"></a><span class="co">        Compute the values for the three </span></span>
<span id="cb16-759"><a href="#cb16-759" aria-hidden="true" tabindex="-1"></a><span class="co">        positive and negative intervals.</span></span>
<span id="cb16-760"><a href="#cb16-760" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-761"><a href="#cb16-761" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">getattr</span>(row, i)</span>
<span id="cb16-762"><a href="#cb16-762" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-763"><a href="#cb16-763" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.isnan(val):</span>
<span id="cb16-764"><a href="#cb16-764" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>):</span>
<span id="cb16-765"><a href="#cb16-765" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb16-766"><a href="#cb16-766" aria-hidden="true" tabindex="-1"></a>            <span class="co"># for nan color</span></span>
<span id="cb16-767"><a href="#cb16-767" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> cut</span>
<span id="cb16-768"><a href="#cb16-768" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-769"><a href="#cb16-769" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> val <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-770"><a href="#cb16-770" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb16-771"><a href="#cb16-771" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb16-772"><a href="#cb16-772" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-773"><a href="#cb16-773" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> <span class="bu">abs</span>(val)</span>
<span id="cb16-774"><a href="#cb16-774" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb16-775"><a href="#cb16-775" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> <span class="bu">min</span>(cut, val)</span>
<span id="cb16-776"><a href="#cb16-776" aria-hidden="true" tabindex="-1"></a>                val <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, val<span class="op">-</span>cut)</span>
<span id="cb16-777"><a href="#cb16-777" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> <span class="bu">int</span>(<span class="kw">not</span> isclose(val, <span class="dv">0</span>, abs_tol<span class="op">=</span><span class="fl">1e-8</span>)) <span class="op">*</span> cut</span>
<span id="cb16-778"><a href="#cb16-778" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-779"><a href="#cb16-779" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> val <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb16-780"><a href="#cb16-780" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb16-781"><a href="#cb16-781" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb16-782"><a href="#cb16-782" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-783"><a href="#cb16-783" aria-hidden="true" tabindex="-1"></a>            <span class="co"># for nan color</span></span>
<span id="cb16-784"><a href="#cb16-784" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> <span class="dv">0</span></span>
<span id="cb16-785"><a href="#cb16-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-786"><a href="#cb16-786" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _horizonplot(<span class="va">self</span>, df, y<span class="op">=</span><span class="va">None</span>, ax<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb16-787"><a href="#cb16-787" aria-hidden="true" tabindex="-1"></a>                    cut<span class="op">=</span><span class="va">None</span>, <span class="co"># float, takes precedence over quantile_span</span></span>
<span id="cb16-788"><a href="#cb16-788" aria-hidden="true" tabindex="-1"></a>                    quantile_span <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-789"><a href="#cb16-789" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span><span class="st">'start'</span>,</span>
<span id="cb16-790"><a href="#cb16-790" aria-hidden="true" tabindex="-1"></a>                    beginzero<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb16-791"><a href="#cb16-791" aria-hidden="true" tabindex="-1"></a>                    offset<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-792"><a href="#cb16-792" aria-hidden="true" tabindex="-1"></a>                    height<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb16-793"><a href="#cb16-793" aria-hidden="true" tabindex="-1"></a>                    colors <span class="op">=</span> [<span class="st">'#CCE2DF'</span>, <span class="st">'#59A9A8'</span>, <span class="st">'#374E9B'</span>, <span class="st">'midnightblue'</span>,</span>
<span id="cb16-794"><a href="#cb16-794" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'#F2DE9A'</span>, <span class="st">'#DA8630'</span>, <span class="st">'#972428'</span>, <span class="st">'darkred'</span>,</span>
<span id="cb16-795"><a href="#cb16-795" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'#D3D3D3'</span>],</span>
<span id="cb16-796"><a href="#cb16-796" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>kwargs):</span>
<span id="cb16-797"><a href="#cb16-797" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># colours = ['#314E9F', '#36AAA8', '#D7E2D4'] + ['midnightblue'] + \</span></span>
<span id="cb16-798"><a href="#cb16-798" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#           ['#F5DE90', '#F5DE90', '#A51023'] + ['darkred'] + ['whitesmoke']):</span></span>
<span id="cb16-799"><a href="#cb16-799" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># colors = sns.color_palette("Blues", 3) + ['midnightblue'] + \</span></span>
<span id="cb16-800"><a href="#cb16-800" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#           sns.color_palette("Reds", 3) + ['darkred'] + ['lightgrey']):</span></span>
<span id="cb16-801"><a href="#cb16-801" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-802"><a href="#cb16-802" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-803"><a href="#cb16-803" aria-hidden="true" tabindex="-1"></a><span class="co">        Horizon bar plot made allowing multiple chromosomes and multiple samples.</span></span>
<span id="cb16-804"><a href="#cb16-804" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-805"><a href="#cb16-805" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-806"><a href="#cb16-806" aria-hidden="true" tabindex="-1"></a>        <span class="co"># set cut if not set</span></span>
<span id="cb16-807"><a href="#cb16-807" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cut <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-808"><a href="#cb16-808" aria-hidden="true" tabindex="-1"></a>            cut <span class="op">=</span> np.<span class="bu">max</span>([np.<span class="bu">max</span>(df[y]), np.<span class="bu">max</span>(<span class="op">-</span>df[y])]) <span class="op">/</span> <span class="dv">3</span></span>
<span id="cb16-809"><a href="#cb16-809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> quantile_span:</span>
<span id="cb16-810"><a href="#cb16-810" aria-hidden="true" tabindex="-1"></a>            cut<span class="op">=</span><span class="bu">max</span>(np.<span class="bu">abs</span>(np.nanquantile(df[col], quantile_span[<span class="dv">0</span>])), </span>
<span id="cb16-811"><a href="#cb16-811" aria-hidden="true" tabindex="-1"></a>                    np.<span class="bu">abs</span>(np.nanquantile(df[col], quantile_span[<span class="dv">1</span>]))) <span class="op">/</span> <span class="dv">3</span>,</span>
<span id="cb16-812"><a href="#cb16-812" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-813"><a href="#cb16-813" aria-hidden="true" tabindex="-1"></a>        <span class="co"># make the data frame to plot</span></span>
<span id="cb16-814"><a href="#cb16-814" aria-hidden="true" tabindex="-1"></a>        row_iter <span class="op">=</span> df.itertuples()</span>
<span id="cb16-815"><a href="#cb16-815" aria-hidden="true" tabindex="-1"></a>        col_iterators <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>(<span class="va">self</span>._horizon(row, y, cut) <span class="cf">for</span> row <span class="kw">in</span> row_iter))</span>
<span id="cb16-816"><a href="#cb16-816" aria-hidden="true" tabindex="-1"></a>        col_names <span class="op">=</span> [<span class="st">'yp1'</span>, <span class="st">'yp2'</span>, <span class="st">'yp3'</span>, <span class="st">'yp4'</span>, </span>
<span id="cb16-817"><a href="#cb16-817" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'yn1'</span>, <span class="st">'yn2'</span>, <span class="st">'yn3'</span>, <span class="st">'yn4'</span>, <span class="st">'nan'</span>]</span>
<span id="cb16-818"><a href="#cb16-818" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-819"><a href="#cb16-819" aria-hidden="true" tabindex="-1"></a>        df2 <span class="op">=</span> (df[[y, x]]</span>
<span id="cb16-820"><a href="#cb16-820" aria-hidden="true" tabindex="-1"></a>               .assign(<span class="op">**</span><span class="bu">dict</span>(<span class="bu">zip</span>(col_names, col_iterators)))</span>
<span id="cb16-821"><a href="#cb16-821" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb16-822"><a href="#cb16-822" aria-hidden="true" tabindex="-1"></a>        df2 <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>((col, <span class="bu">list</span>(chain.from_iterable(<span class="bu">zip</span>(df2[col].values, df2[col].values)))) <span class="cf">for</span> col <span class="kw">in</span> df2))</span>
<span id="cb16-823"><a href="#cb16-823" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-824"><a href="#cb16-824" aria-hidden="true" tabindex="-1"></a>        <span class="co"># make the plot</span></span>
<span id="cb16-825"><a href="#cb16-825" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> sns.axes_style(<span class="st">"ticks"</span>):</span>
<span id="cb16-826"><a href="#cb16-826" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-827"><a href="#cb16-827" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ingore UserWarning from seaborn that tight_layout is not applied</span></span>
<span id="cb16-828"><a href="#cb16-828" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb16-829"><a href="#cb16-829" aria-hidden="true" tabindex="-1"></a>                warnings.simplefilter(<span class="st">"ignore"</span>)</span>
<span id="cb16-830"><a href="#cb16-830" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-831"><a href="#cb16-831" aria-hidden="true" tabindex="-1"></a>                <span class="co"># first y tick</span></span>
<span id="cb16-832"><a href="#cb16-832" aria-hidden="true" tabindex="-1"></a>                ytic1 <span class="op">=</span> <span class="bu">round</span>(cut<span class="op">/</span><span class="dv">3</span>, <span class="op">-</span><span class="bu">int</span>(floor(log10(<span class="bu">abs</span>(cut<span class="op">/</span><span class="dv">3</span>)))))</span>
<span id="cb16-833"><a href="#cb16-833" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-834"><a href="#cb16-834" aria-hidden="true" tabindex="-1"></a>                scale <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb16-835"><a href="#cb16-835" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> height <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-836"><a href="#cb16-836" aria-hidden="true" tabindex="-1"></a>                    ymax <span class="op">=</span> <span class="bu">max</span>(df2[col_name].<span class="bu">max</span>() <span class="cf">for</span> col_name <span class="kw">in</span> col_names)</span>
<span id="cb16-837"><a href="#cb16-837" aria-hidden="true" tabindex="-1"></a>                    ymin <span class="op">=</span> <span class="bu">max</span>(df2[col_name].<span class="bu">min</span>() <span class="cf">for</span> col_name <span class="kw">in</span> col_names)</span>
<span id="cb16-838"><a href="#cb16-838" aria-hidden="true" tabindex="-1"></a>                    scale <span class="op">=</span> height<span class="op">/</span>(ymax<span class="op">-</span>ymin)</span>
<span id="cb16-839"><a href="#cb16-839" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-840"><a href="#cb16-840" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> col_name, color <span class="kw">in</span> <span class="bu">zip</span>(col_names, colors):</span>
<span id="cb16-841"><a href="#cb16-841" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># plt.setp(fig.texts, text="") # hack to make y facet labels align...</span></span>
<span id="cb16-842"><a href="#cb16-842" aria-hidden="true" tabindex="-1"></a>                    ax.fill_between(</span>
<span id="cb16-843"><a href="#cb16-843" aria-hidden="true" tabindex="-1"></a>                        df2[x], </span>
<span id="cb16-844"><a href="#cb16-844" aria-hidden="true" tabindex="-1"></a>                        df2[col_name]<span class="op">*</span>scale<span class="op">+</span>offset, </span>
<span id="cb16-845"><a href="#cb16-845" aria-hidden="true" tabindex="-1"></a>                        y2<span class="op">=</span>offset,</span>
<span id="cb16-846"><a href="#cb16-846" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span>color,</span>
<span id="cb16-847"><a href="#cb16-847" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-848"><a href="#cb16-848" aria-hidden="true" tabindex="-1"></a>                        capstyle<span class="op">=</span><span class="st">'butt'</span>,</span>
<span id="cb16-849"><a href="#cb16-849" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>kwargs)</span>
<span id="cb16-850"><a href="#cb16-850" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-851"><a href="#cb16-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-852"><a href="#cb16-852" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> horizon(<span class="va">self</span>, data<span class="op">=</span><span class="va">None</span>, chrom_col<span class="op">=</span><span class="st">'chrom'</span>, y<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb16-853"><a href="#cb16-853" aria-hidden="true" tabindex="-1"></a>                    cut<span class="op">=</span><span class="va">None</span>, <span class="co"># float, takes precedence over quantile_span</span></span>
<span id="cb16-854"><a href="#cb16-854" aria-hidden="true" tabindex="-1"></a>                    quantile_span <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-855"><a href="#cb16-855" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span><span class="st">'start'</span>,</span>
<span id="cb16-856"><a href="#cb16-856" aria-hidden="true" tabindex="-1"></a>                    beginzero<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb16-857"><a href="#cb16-857" aria-hidden="true" tabindex="-1"></a>                    base<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb16-858"><a href="#cb16-858" aria-hidden="true" tabindex="-1"></a>                    height<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-859"><a href="#cb16-859" aria-hidden="true" tabindex="-1"></a>                    colors <span class="op">=</span> [<span class="st">'#CCE2DF'</span>, <span class="st">'#59A9A8'</span>, <span class="st">'#374E9B'</span>, <span class="st">'midnightblue'</span>,</span>
<span id="cb16-860"><a href="#cb16-860" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'#F2DE9A'</span>, <span class="st">'#DA8630'</span>, <span class="st">'#972428'</span>, <span class="st">'darkred'</span>,</span>
<span id="cb16-861"><a href="#cb16-861" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'#D3D3D3'</span>],</span>
<span id="cb16-862"><a href="#cb16-862" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>kwargs):</span>
<span id="cb16-863"><a href="#cb16-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-864"><a href="#cb16-864" aria-hidden="true" tabindex="-1"></a>        grouped <span class="op">=</span> data.groupby(chrom_col, observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-865"><a href="#cb16-865" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chrom, group <span class="kw">in</span> grouped:</span>
<span id="cb16-866"><a href="#cb16-866" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> <span class="va">self</span>.chr_axes[chrom]</span>
<span id="cb16-867"><a href="#cb16-867" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-868"><a href="#cb16-868" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> group.reset_index() <span class="co"># make copy</span></span>
<span id="cb16-869"><a href="#cb16-869" aria-hidden="true" tabindex="-1"></a>            <span class="co"># scaled_y_lim = ax.get_ylim()</span></span>
<span id="cb16-870"><a href="#cb16-870" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if 'ylim' in kwargs:</span></span>
<span id="cb16-871"><a href="#cb16-871" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     dy = -sub(*ylim)</span></span>
<span id="cb16-872"><a href="#cb16-872" aria-hidden="true" tabindex="-1"></a>            <span class="co"># else:</span></span>
<span id="cb16-873"><a href="#cb16-873" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     dy = -sub(*self.ylim)</span></span>
<span id="cb16-874"><a href="#cb16-874" aria-hidden="true" tabindex="-1"></a>            <span class="co"># df = group.copy()</span></span>
<span id="cb16-875"><a href="#cb16-875" aria-hidden="true" tabindex="-1"></a>            <span class="co"># if yaxis is None:</span></span>
<span id="cb16-876"><a href="#cb16-876" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     df['y'] = df.y * -sub(*scaled_y_lim) / -sub(*self.ylim)</span></span>
<span id="cb16-877"><a href="#cb16-877" aria-hidden="true" tabindex="-1"></a>            <span class="co"># else:</span></span>
<span id="cb16-878"><a href="#cb16-878" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     bottom, top = yaxis</span></span>
<span id="cb16-879"><a href="#cb16-879" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     df['y'] -= df.y.min()</span></span>
<span id="cb16-880"><a href="#cb16-880" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     df['y'] /= df.y.max()</span></span>
<span id="cb16-881"><a href="#cb16-881" aria-hidden="true" tabindex="-1"></a>            <span class="co">#     df['y'] = df.y * ((top-bottom) * -sub(*scaled_y_lim)) / -sub(*self.ylim) + bottom /  -sub(*self.ylim) * -sub(*scaled_y_lim)</span></span>
<span id="cb16-882"><a href="#cb16-882" aria-hidden="true" tabindex="-1"></a>            <span class="co"># g = fun(df, ax=ax, **kwargs)</span></span>
<span id="cb16-883"><a href="#cb16-883" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._horizonplot(df, y<span class="op">=</span>y, ax<span class="op">=</span>ax,</span>
<span id="cb16-884"><a href="#cb16-884" aria-hidden="true" tabindex="-1"></a>                    cut<span class="op">=</span>cut, <span class="co"># float, takes precedence over quantile_span</span></span>
<span id="cb16-885"><a href="#cb16-885" aria-hidden="true" tabindex="-1"></a>                    quantile_span <span class="op">=</span> quantile_span,</span>
<span id="cb16-886"><a href="#cb16-886" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span>x,</span>
<span id="cb16-887"><a href="#cb16-887" aria-hidden="true" tabindex="-1"></a>                    beginzero<span class="op">=</span>beginzero, </span>
<span id="cb16-888"><a href="#cb16-888" aria-hidden="true" tabindex="-1"></a>                    offset<span class="op">=</span><span class="va">self</span>.map_y(base, ax),</span>
<span id="cb16-889"><a href="#cb16-889" aria-hidden="true" tabindex="-1"></a>                    height<span class="op">=</span><span class="va">self</span>.map_y(height, ax),</span>
<span id="cb16-890"><a href="#cb16-890" aria-hidden="true" tabindex="-1"></a>                    colors <span class="op">=</span> colors,</span>
<span id="cb16-891"><a href="#cb16-891" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>kwargs)</span>
<span id="cb16-892"><a href="#cb16-892" aria-hidden="true" tabindex="-1"></a>                             </span>
<span id="cb16-893"><a href="#cb16-893" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ax <span class="kw">in</span> <span class="va">self</span>.zoom_axes:</span>
<span id="cb16-894"><a href="#cb16-894" aria-hidden="true" tabindex="-1"></a>                <span class="co"># scaled_y_lim = ax.get_ylim()</span></span>
<span id="cb16-895"><a href="#cb16-895" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if 'ylim' in kwargs:</span></span>
<span id="cb16-896"><a href="#cb16-896" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dy = -sub(*ylim)</span></span>
<span id="cb16-897"><a href="#cb16-897" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else:</span></span>
<span id="cb16-898"><a href="#cb16-898" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     dy = -sub(*self.ylim)</span></span>
<span id="cb16-899"><a href="#cb16-899" aria-hidden="true" tabindex="-1"></a>                <span class="co"># df = group.copy()</span></span>
<span id="cb16-900"><a href="#cb16-900" aria-hidden="true" tabindex="-1"></a>                <span class="co"># if yaxis is None:</span></span>
<span id="cb16-901"><a href="#cb16-901" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df['y'] = df.y * -sub(*scaled_y_lim) / -sub(*self.ylim)</span></span>
<span id="cb16-902"><a href="#cb16-902" aria-hidden="true" tabindex="-1"></a>                <span class="co"># else:</span></span>
<span id="cb16-903"><a href="#cb16-903" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     bottom, top = yaxis</span></span>
<span id="cb16-904"><a href="#cb16-904" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df['y'] -= df.y.min()</span></span>
<span id="cb16-905"><a href="#cb16-905" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df['y'] /= df.y.max()</span></span>
<span id="cb16-906"><a href="#cb16-906" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df['y'] = df.y * ((top-bottom) * -sub(*scaled_y_lim)) / -sub(*self.ylim) + bottom /  -sub(*self.ylim) * -sub(*scaled_y_lim)</span></span>
<span id="cb16-907"><a href="#cb16-907" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._horizonplot(df, y<span class="op">=</span>y, ax<span class="op">=</span>ax,</span>
<span id="cb16-908"><a href="#cb16-908" aria-hidden="true" tabindex="-1"></a>                    cut<span class="op">=</span>cut, <span class="co"># float, takes precedence over quantile_span</span></span>
<span id="cb16-909"><a href="#cb16-909" aria-hidden="true" tabindex="-1"></a>                    quantile_span <span class="op">=</span> quantile_span,</span>
<span id="cb16-910"><a href="#cb16-910" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span>x,</span>
<span id="cb16-911"><a href="#cb16-911" aria-hidden="true" tabindex="-1"></a>                    beginzero<span class="op">=</span>beginzero, </span>
<span id="cb16-912"><a href="#cb16-912" aria-hidden="true" tabindex="-1"></a>                    offset<span class="op">=</span><span class="va">self</span>.map_y(base, ax),</span>
<span id="cb16-913"><a href="#cb16-913" aria-hidden="true" tabindex="-1"></a>                    height<span class="op">=</span><span class="va">self</span>.map_y(height, ax),</span>
<span id="cb16-914"><a href="#cb16-914" aria-hidden="true" tabindex="-1"></a>                    colors <span class="op">=</span> colors,</span>
<span id="cb16-915"><a href="#cb16-915" aria-hidden="true" tabindex="-1"></a>                    <span class="op">**</span>kwargs)</span>
<span id="cb16-916"><a href="#cb16-916" aria-hidden="true" tabindex="-1"></a>                <span class="co"># try:</span></span>
<span id="cb16-917"><a href="#cb16-917" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     ax.get_legend().remove()</span></span>
<span id="cb16-918"><a href="#cb16-918" aria-hidden="true" tabindex="-1"></a>                <span class="co"># except:</span></span>
<span id="cb16-919"><a href="#cb16-919" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     pass                               </span></span>
<span id="cb16-920"><a href="#cb16-920" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.xlabel('')</span></span>
<span id="cb16-921"><a href="#cb16-921" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plt.ylabel('')</span></span>
<span id="cb16-922"><a href="#cb16-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-923"><a href="#cb16-923" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-924"><a href="#cb16-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-925"><a href="#cb16-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-926"><a href="#cb16-926" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ChromIdeogram(GenomeIdeogram):</span>
<span id="cb16-927"><a href="#cb16-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-928"><a href="#cb16-928" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, chrom, axes_height_inches<span class="op">=</span><span class="dv">1</span>, axes_width_inches<span class="op">=</span><span class="dv">12</span>, hspace<span class="op">=</span><span class="fl">0.3</span>, </span>
<span id="cb16-929"><a href="#cb16-929" aria-hidden="true" tabindex="-1"></a>                 ylim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>), zooms<span class="op">=</span>[], wspace<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb16-930"><a href="#cb16-930" aria-hidden="true" tabindex="-1"></a>                 rel_font_height<span class="op">=</span><span class="fl">0.05</span>, assembly:<span class="bu">str</span><span class="op">=</span><span class="st">'hg38'</span>, min_stick_height<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb16-931"><a href="#cb16-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-932"><a href="#cb16-932" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_base <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-933"><a href="#cb16-933" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ideogram_height <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-934"><a href="#cb16-934" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.legend_handles <span class="op">=</span> []</span>
<span id="cb16-935"><a href="#cb16-935" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height_ratios <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb16-936"><a href="#cb16-936" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.zooms <span class="op">=</span> zooms</span>
<span id="cb16-937"><a href="#cb16-937" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.zoom_axes <span class="op">=</span> []</span>
<span id="cb16-938"><a href="#cb16-938" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.end_padding <span class="op">=</span> <span class="dv">300000</span></span>
<span id="cb16-939"><a href="#cb16-939" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.min_stick_height <span class="op">=</span> min_stick_height</span>
<span id="cb16-940"><a href="#cb16-940" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-941"><a href="#cb16-941" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chr_names <span class="op">=</span> [chrom]</span>
<span id="cb16-942"><a href="#cb16-942" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.chr_sizes <span class="op">=</span> [<span class="va">self</span>.chrom_lengths[assembly][chrom] <span class="cf">for</span> chrom <span class="kw">in</span> <span class="va">self</span>.chr_names]</span>
<span id="cb16-943"><a href="#cb16-943" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_chrom_size <span class="op">=</span> <span class="bu">max</span>(<span class="va">self</span>.chr_sizes)</span>
<span id="cb16-944"><a href="#cb16-944" aria-hidden="true" tabindex="-1"></a>        nr_rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb16-945"><a href="#cb16-945" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.aspect <span class="op">=</span> axes_height_inches <span class="op">/</span> axes_width_inches</span>
<span id="cb16-946"><a href="#cb16-946" aria-hidden="true" tabindex="-1"></a>        axes_width <span class="op">=</span> <span class="va">self</span>.max_chrom_size</span>
<span id="cb16-947"><a href="#cb16-947" aria-hidden="true" tabindex="-1"></a>        axes_height <span class="op">=</span> <span class="va">self</span>.aspect <span class="op">*</span> <span class="va">self</span>.max_chrom_size <span class="op">+</span> (<span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.end_padding)</span>
<span id="cb16-948"><a href="#cb16-948" aria-hidden="true" tabindex="-1"></a>        fig_height_inches <span class="op">=</span> axes_height_inches</span>
<span id="cb16-949"><a href="#cb16-949" aria-hidden="true" tabindex="-1"></a>        point_size <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">72</span></span>
<span id="cb16-950"><a href="#cb16-950" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ylim <span class="op">=</span> ylim</span>
<span id="cb16-951"><a href="#cb16-951" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.font_size <span class="op">=</span> rel_font_height <span class="op">*</span> axes_height_inches <span class="op">/</span> point_size</span>
<span id="cb16-952"><a href="#cb16-952" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> zooms:</span>
<span id="cb16-953"><a href="#cb16-953" aria-hidden="true" tabindex="-1"></a>             fig_height_inches <span class="op">+=</span> (<span class="dv">1</span> <span class="op">+</span> hspace) <span class="op">*</span> axes_height_inches</span>
<span id="cb16-954"><a href="#cb16-954" aria-hidden="true" tabindex="-1"></a>        fig_width_inches <span class="op">=</span> axes_width_inches</span>
<span id="cb16-955"><a href="#cb16-955" aria-hidden="true" tabindex="-1"></a>        figsize <span class="op">=</span> (fig_width_inches, fig_height_inches)</span>
<span id="cb16-956"><a href="#cb16-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-957"><a href="#cb16-957" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> plt.rc_context(<span class="va">self</span>.d):</span>
<span id="cb16-958"><a href="#cb16-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-959"><a href="#cb16-959" aria-hidden="true" tabindex="-1"></a>            xlim <span class="op">=</span> (<span class="op">-</span><span class="va">self</span>.end_padding, <span class="va">self</span>.chr_sizes[<span class="dv">0</span>]<span class="op">+</span><span class="va">self</span>.end_padding)</span>
<span id="cb16-960"><a href="#cb16-960" aria-hidden="true" tabindex="-1"></a>            scaled_y_lim <span class="op">=</span> xlim[<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.aspect, xlim[<span class="dv">1</span>] <span class="op">*</span> <span class="va">self</span>.aspect</span>
<span id="cb16-961"><a href="#cb16-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-962"><a href="#cb16-962" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> zooms:</span>
<span id="cb16-963"><a href="#cb16-963" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.fig <span class="op">=</span>  plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb16-964"><a href="#cb16-964" aria-hidden="true" tabindex="-1"></a>                axs <span class="op">=</span> <span class="va">self</span>.fig.subplot_mosaic([</span>
<span id="cb16-965"><a href="#cb16-965" aria-hidden="true" tabindex="-1"></a>                    [<span class="st">"main"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(zooms))],</span>
<span id="cb16-966"><a href="#cb16-966" aria-hidden="true" tabindex="-1"></a>                    [<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(zooms))]],</span>
<span id="cb16-967"><a href="#cb16-967" aria-hidden="true" tabindex="-1"></a>                     width_ratios<span class="op">=</span>[<span class="op">-</span>sub(<span class="op">*</span>tup) <span class="cf">for</span> tup <span class="kw">in</span> zooms],</span>
<span id="cb16-968"><a href="#cb16-968" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb16-969"><a href="#cb16-969" aria-hidden="true" tabindex="-1"></a>                axs[<span class="st">"main"</span>].<span class="bu">set</span>(xlim<span class="op">=</span>xlim)</span>
<span id="cb16-970"><a href="#cb16-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-971"><a href="#cb16-971" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(zooms)):</span>
<span id="cb16-972"><a href="#cb16-972" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.zoom_effect(axs[<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>], axs[<span class="st">"main"</span>])</span>
<span id="cb16-973"><a href="#cb16-973" aria-hidden="true" tabindex="-1"></a>                    axs[<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>].<span class="bu">set</span>(xlim<span class="op">=</span>zooms[i])</span>
<span id="cb16-974"><a href="#cb16-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-975"><a href="#cb16-975" aria-hidden="true" tabindex="-1"></a>                    zoom_scaled_y_lim <span class="op">=</span> <span class="va">self</span>.scaled_y_lim(axs[<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>])</span>
<span id="cb16-976"><a href="#cb16-976" aria-hidden="true" tabindex="-1"></a>                    axs[<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>].<span class="bu">set</span>(ylim<span class="op">=</span>zoom_scaled_y_lim)</span>
<span id="cb16-977"><a href="#cb16-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-978"><a href="#cb16-978" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.ax <span class="op">=</span> axs[<span class="st">"main"</span>]</span>
<span id="cb16-979"><a href="#cb16-979" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.zoom_axes <span class="op">=</span> [axs[<span class="ss">f"zoom</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(zooms))]</span>
<span id="cb16-980"><a href="#cb16-980" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-981"><a href="#cb16-981" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.zoom_axes)):</span>
<span id="cb16-982"><a href="#cb16-982" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.zoom_axes[i].sharey(<span class="va">self</span>.zoom_axes[<span class="dv">0</span>])</span>
<span id="cb16-983"><a href="#cb16-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-984"><a href="#cb16-984" aria-hidden="true" tabindex="-1"></a>                plt.subplots_adjust(wspace<span class="op">=</span>wspace)</span>
<span id="cb16-985"><a href="#cb16-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-986"><a href="#cb16-986" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:        </span>
<span id="cb16-987"><a href="#cb16-987" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.fig, <span class="va">self</span>.ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>figsize)</span>
<span id="cb16-988"><a href="#cb16-988" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-989"><a href="#cb16-989" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hspace <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-990"><a href="#cb16-990" aria-hidden="true" tabindex="-1"></a>                plt.subplots_adjust(hspace<span class="op">=</span>hspace)</span>
<span id="cb16-991"><a href="#cb16-991" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-992"><a href="#cb16-992" aria-hidden="true" tabindex="-1"></a>            plt.minorticks_on()</span>
<span id="cb16-993"><a href="#cb16-993" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-994"><a href="#cb16-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-995"><a href="#cb16-995" aria-hidden="true" tabindex="-1"></a>            nr_rows, nr_cols <span class="op">=</span> <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb16-996"><a href="#cb16-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-997"><a href="#cb16-997" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-998"><a href="#cb16-998" aria-hidden="true" tabindex="-1"></a>            <span class="co"># gs = matplotlib.gridspec.GridSpec(nr_rows, 25)</span></span>
<span id="cb16-999"><a href="#cb16-999" aria-hidden="true" tabindex="-1"></a>            gs <span class="op">=</span> matplotlib.gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb16-1000"><a href="#cb16-1000" aria-hidden="true" tabindex="-1"></a>            gs.update(wspace<span class="op">=</span><span class="dv">0</span>, hspace<span class="op">=</span>hspace) </span>
<span id="cb16-1001"><a href="#cb16-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1002"><a href="#cb16-1002" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.set_xlim(xlim)</span>
<span id="cb16-1003"><a href="#cb16-1003" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.set_ylim(scaled_y_lim)                </span>
<span id="cb16-1004"><a href="#cb16-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1005"><a href="#cb16-1005" aria-hidden="true" tabindex="-1"></a>            <span class="co"># start, end = 0, self.chr_sizes[i]</span></span>
<span id="cb16-1006"><a href="#cb16-1006" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ax.set_xlim(start, end)</span></span>
<span id="cb16-1007"><a href="#cb16-1007" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.spines[[<span class="st">'right'</span>, <span class="st">'top'</span>, <span class="st">'left'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb16-1008"><a href="#cb16-1008" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> <span class="op">-</span><span class="va">self</span>.end_padding <span class="op">*</span> <span class="dv">10</span> <span class="op">/</span> figsize[<span class="dv">1</span>]</span>
<span id="cb16-1009"><a href="#cb16-1009" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.set_yticklabels([])</span>
<span id="cb16-1010"><a href="#cb16-1010" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.set_xticks(np.arange(<span class="dv">0</span>, <span class="va">self</span>.chr_sizes[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>, <span class="dv">10_000_000</span>))</span>
<span id="cb16-1011"><a href="#cb16-1011" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.xaxis.tick_bottom()</span>
<span id="cb16-1012"><a href="#cb16-1012" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.spines[<span class="st">'bottom'</span>].set_visible(<span class="va">True</span>)                    </span>
<span id="cb16-1013"><a href="#cb16-1013" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.yaxis.set_ticks_position(<span class="st">'none'</span>)</span>
<span id="cb16-1014"><a href="#cb16-1014" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.yaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb16-1015"><a href="#cb16-1015" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax.set_yticklabels([])</span>
<span id="cb16-1016"><a href="#cb16-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1017"><a href="#cb16-1017" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ax_list <span class="op">=</span> [<span class="va">self</span>.ax]</span>
<span id="cb16-1018"><a href="#cb16-1018" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1019"><a href="#cb16-1019" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.chr_axes <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(<span class="va">self</span>.chr_names, <span class="va">self</span>.ax_list))</span>
<span id="cb16-1020"><a href="#cb16-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1021"><a href="#cb16-1021" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1022"><a href="#cb16-1022" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> connect_bbox(<span class="va">self</span>, bbox1, bbox2,</span>
<span id="cb16-1023"><a href="#cb16-1023" aria-hidden="true" tabindex="-1"></a>                     loc1a, loc2a, loc1b, loc2b,</span>
<span id="cb16-1024"><a href="#cb16-1024" aria-hidden="true" tabindex="-1"></a>                     prop_lines, prop_patches<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-1025"><a href="#cb16-1025" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prop_patches <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-1026"><a href="#cb16-1026" aria-hidden="true" tabindex="-1"></a>            prop_patches <span class="op">=</span> {</span>
<span id="cb16-1027"><a href="#cb16-1027" aria-hidden="true" tabindex="-1"></a>                <span class="op">**</span>prop_lines,</span>
<span id="cb16-1028"><a href="#cb16-1028" aria-hidden="true" tabindex="-1"></a>                <span class="st">"alpha"</span>: prop_lines.get(<span class="st">"alpha"</span>, <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.2</span>,</span>
<span id="cb16-1029"><a href="#cb16-1029" aria-hidden="true" tabindex="-1"></a>                <span class="st">"clip_on"</span>: <span class="va">False</span>,</span>
<span id="cb16-1030"><a href="#cb16-1030" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb16-1031"><a href="#cb16-1031" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1032"><a href="#cb16-1032" aria-hidden="true" tabindex="-1"></a>        c1 <span class="op">=</span> BboxConnector(</span>
<span id="cb16-1033"><a href="#cb16-1033" aria-hidden="true" tabindex="-1"></a>            bbox1, bbox2, loc1<span class="op">=</span>loc1a, loc2<span class="op">=</span>loc2a, clip_on<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>prop_lines)</span>
<span id="cb16-1034"><a href="#cb16-1034" aria-hidden="true" tabindex="-1"></a>        c2 <span class="op">=</span> BboxConnector(</span>
<span id="cb16-1035"><a href="#cb16-1035" aria-hidden="true" tabindex="-1"></a>            bbox1, bbox2, loc1<span class="op">=</span>loc1b, loc2<span class="op">=</span>loc2b, clip_on<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>prop_lines)</span>
<span id="cb16-1036"><a href="#cb16-1036" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1037"><a href="#cb16-1037" aria-hidden="true" tabindex="-1"></a>        bbox_patch1 <span class="op">=</span> BboxPatch(bbox1, ec<span class="op">=</span><span class="st">'none'</span>, fc<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb16-1038"><a href="#cb16-1038" aria-hidden="true" tabindex="-1"></a>        bbox_patch2 <span class="op">=</span> BboxPatch(bbox2, <span class="op">**</span>prop_patches)</span>
<span id="cb16-1039"><a href="#cb16-1039" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1040"><a href="#cb16-1040" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> BboxConnectorPatch(bbox1, bbox2,</span>
<span id="cb16-1041"><a href="#cb16-1041" aria-hidden="true" tabindex="-1"></a>                               loc1a<span class="op">=</span>loc1a, loc2a<span class="op">=</span>loc2a, loc1b<span class="op">=</span>loc1b, loc2b<span class="op">=</span>loc2b,</span>
<span id="cb16-1042"><a href="#cb16-1042" aria-hidden="true" tabindex="-1"></a>                               clip_on<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb16-1043"><a href="#cb16-1043" aria-hidden="true" tabindex="-1"></a>                               <span class="op">**</span>prop_patches)</span>
<span id="cb16-1044"><a href="#cb16-1044" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1045"><a href="#cb16-1045" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> c1, c2, bbox_patch1, bbox_patch2, p</span>
<span id="cb16-1046"><a href="#cb16-1046" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1047"><a href="#cb16-1047" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1048"><a href="#cb16-1048" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> zoom_effect(<span class="va">self</span>, ax1, ax2, <span class="op">**</span>kwargs):</span>
<span id="cb16-1049"><a href="#cb16-1049" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-1050"><a href="#cb16-1050" aria-hidden="true" tabindex="-1"></a><span class="co">        ax1 : the main Axes</span></span>
<span id="cb16-1051"><a href="#cb16-1051" aria-hidden="true" tabindex="-1"></a><span class="co">        ax1 : the zoomed Axes</span></span>
<span id="cb16-1052"><a href="#cb16-1052" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb16-1053"><a href="#cb16-1053" aria-hidden="true" tabindex="-1"></a><span class="co">        Similar to zoom_effect01.  The xmin &amp; xmax will be taken from the</span></span>
<span id="cb16-1054"><a href="#cb16-1054" aria-hidden="true" tabindex="-1"></a><span class="co">        ax1.viewLim.</span></span>
<span id="cb16-1055"><a href="#cb16-1055" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-1056"><a href="#cb16-1056" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1057"><a href="#cb16-1057" aria-hidden="true" tabindex="-1"></a>        tt <span class="op">=</span> ax1.transScale <span class="op">+</span> (ax1.transLimits <span class="op">+</span> ax2.transAxes)</span>
<span id="cb16-1058"><a href="#cb16-1058" aria-hidden="true" tabindex="-1"></a>        trans <span class="op">=</span> blended_transform_factory(ax2.transData, tt)</span>
<span id="cb16-1059"><a href="#cb16-1059" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1060"><a href="#cb16-1060" aria-hidden="true" tabindex="-1"></a>        mybbox1 <span class="op">=</span> ax1.bbox</span>
<span id="cb16-1061"><a href="#cb16-1061" aria-hidden="true" tabindex="-1"></a>        mybbox2 <span class="op">=</span> TransformedBbox(ax1.viewLim, trans)</span>
<span id="cb16-1062"><a href="#cb16-1062" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1063"><a href="#cb16-1063" aria-hidden="true" tabindex="-1"></a>        prop_patches <span class="op">=</span> {<span class="op">**</span>kwargs, <span class="st">'ec'</span>: <span class="st">'black'</span>, <span class="st">'fc'</span>: <span class="st">'lightgray'</span>, <span class="st">'alpha'</span>: <span class="fl">0.3</span>, <span class="st">'linewidth'</span>: <span class="fl">0.5</span>}</span>
<span id="cb16-1064"><a href="#cb16-1064" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1065"><a href="#cb16-1065" aria-hidden="true" tabindex="-1"></a>        c1, c2, bbox_patch1, bbox_patch2, p <span class="op">=</span> <span class="va">self</span>.connect_bbox(</span>
<span id="cb16-1066"><a href="#cb16-1066" aria-hidden="true" tabindex="-1"></a>            mybbox1, mybbox2,</span>
<span id="cb16-1067"><a href="#cb16-1067" aria-hidden="true" tabindex="-1"></a>            loc1a<span class="op">=</span><span class="dv">2</span>, loc2a<span class="op">=</span><span class="dv">3</span>, loc1b<span class="op">=</span><span class="dv">1</span>, loc2b<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb16-1068"><a href="#cb16-1068" aria-hidden="true" tabindex="-1"></a>            prop_lines<span class="op">=</span>kwargs, prop_patches<span class="op">=</span>prop_patches)</span>
<span id="cb16-1069"><a href="#cb16-1069" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1070"><a href="#cb16-1070" aria-hidden="true" tabindex="-1"></a>        ax1.add_patch(bbox_patch1)</span>
<span id="cb16-1071"><a href="#cb16-1071" aria-hidden="true" tabindex="-1"></a>        ax2.add_patch(bbox_patch2)</span>
<span id="cb16-1072"><a href="#cb16-1072" aria-hidden="true" tabindex="-1"></a>        ax2.add_patch(c1)</span>
<span id="cb16-1073"><a href="#cb16-1073" aria-hidden="true" tabindex="-1"></a>        ax2.add_patch(c2)</span>
<span id="cb16-1074"><a href="#cb16-1074" aria-hidden="true" tabindex="-1"></a>        ax2.add_patch(p)</span>
<span id="cb16-1075"><a href="#cb16-1075" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1076"><a href="#cb16-1076" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> c1, c2, bbox_patch1, bbox_patch2, p</span>
<span id="cb16-1077"><a href="#cb16-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1078"><a href="#cb16-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1079"><a href="#cb16-1079" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_axes(<span class="va">self</span>, nr_axes<span class="op">=</span><span class="dv">1</span>, height_ratio<span class="op">=</span><span class="fl">1.0</span>, hspace<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-1080"><a href="#cb16-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1081"><a href="#cb16-1081" aria-hidden="true" tabindex="-1"></a>        new_axes <span class="op">=</span> []</span>
<span id="cb16-1082"><a href="#cb16-1082" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(nr_axes):</span>
<span id="cb16-1083"><a href="#cb16-1083" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1084"><a href="#cb16-1084" aria-hidden="true" tabindex="-1"></a>            gs <span class="op">=</span> <span class="va">self</span>.ax.get_gridspec()</span>
<span id="cb16-1085"><a href="#cb16-1085" aria-hidden="true" tabindex="-1"></a>            row <span class="op">=</span> gs.nrows <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb16-1086"><a href="#cb16-1086" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.height_ratios.append(height_ratio)</span>
<span id="cb16-1087"><a href="#cb16-1087" aria-hidden="true" tabindex="-1"></a>            gs <span class="op">=</span> gridspec.GridSpec(row, <span class="dv">1</span>, height_ratios<span class="op">=</span><span class="va">self</span>.height_ratios, hspace<span class="op">=</span>hspace)</span>
<span id="cb16-1088"><a href="#cb16-1088" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.fig.axes):</span>
<span id="cb16-1089"><a href="#cb16-1089" aria-hidden="true" tabindex="-1"></a>                ax.set_position(gs[i].get_position(<span class="va">self</span>.fig))</span>
<span id="cb16-1090"><a href="#cb16-1090" aria-hidden="true" tabindex="-1"></a>                ax.set_subplotspec(gs[i])</span>
<span id="cb16-1091"><a href="#cb16-1091" aria-hidden="true" tabindex="-1"></a>            new_ax <span class="op">=</span> <span class="va">self</span>.fig.add_subplot(gs[row<span class="op">-</span><span class="dv">1</span>], sharex<span class="op">=</span>ax)</span>
<span id="cb16-1092"><a href="#cb16-1092" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.fig.set_figheight(<span class="va">self</span>.fig.get_figheight()<span class="op">*</span><span class="bu">sum</span>(<span class="va">self</span>.height_ratios)<span class="op">/</span><span class="bu">sum</span>(<span class="va">self</span>.height_ratios[:<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb16-1093"><a href="#cb16-1093" aria-hidden="true" tabindex="-1"></a>            new_ax.spines[[<span class="st">'right'</span>, <span class="st">'top'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb16-1094"><a href="#cb16-1094" aria-hidden="true" tabindex="-1"></a>            new_ax.xaxis.set_visible(<span class="va">False</span>)</span>
<span id="cb16-1095"><a href="#cb16-1095" aria-hidden="true" tabindex="-1"></a>            <span class="co"># new_ax.spines[['bottom']].set_visible(False)</span></span>
<span id="cb16-1096"><a href="#cb16-1096" aria-hidden="true" tabindex="-1"></a>            new_axes.append(new_ax)</span>
<span id="cb16-1097"><a href="#cb16-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1098"><a href="#cb16-1098" aria-hidden="true" tabindex="-1"></a>        new_axes[<span class="op">-</span><span class="dv">1</span>].xaxis.tick_bottom()</span>
<span id="cb16-1099"><a href="#cb16-1099" aria-hidden="true" tabindex="-1"></a>        new_axes[<span class="op">-</span><span class="dv">1</span>].xaxis.set_visible(<span class="va">True</span>)</span>
<span id="cb16-1100"><a href="#cb16-1100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># new_axes[-1].spines[['bottom']].set_visible(True)</span></span>
<span id="cb16-1101"><a href="#cb16-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1102"><a href="#cb16-1102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nr_axes <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-1103"><a href="#cb16-1103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> new_axes[<span class="dv">0</span>]</span>
<span id="cb16-1104"><a href="#cb16-1104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-1105"><a href="#cb16-1105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> new_axes</span>
<span id="cb16-1106"><a href="#cb16-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1107"><a href="#cb16-1107" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># _names = random.choices(['AKAP4', 'DYNLT3', 'MAGEA4', 'TP53'], k=200)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># _pos = sorted(np.random.randint(1, 250000000, 200).tolist())</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # _colors = ['black']*200</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># _colors = random.choices(['blue', 'brown', 'green', 'orange'], k=200)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># annot = list(zip(['chr1']*200, _pos, _names, _colors))</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_google_sheet():</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    SHEET_ID <span class="op">=</span> <span class="st">'1JSjSLuto3jqdEnnG7JqzeC_1pUZw76n7XueVAYrUOpk'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    SHEET_NAME <span class="op">=</span> <span class="st">'Sheet1'</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f'https://docs.google.com/spreadsheets/d/</span><span class="sc">{</span>SHEET_ID<span class="sc">}</span><span class="ss">/gviz/tq?tqx=out:csv&amp;sheet=</span><span class="sc">{</span>SHEET_NAME<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(url, header<span class="op">=</span><span class="dv">1</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.loc[:, [<span class="kw">not</span> x.startswith(<span class="st">'Unnamed'</span>) <span class="cf">for</span> x <span class="kw">in</span> df.columns]]</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gene_list_names():</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> read_google_sheet()</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sorted</span>(df.columns.tolist())</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gene_list(name):</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> read_google_sheet()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    sr <span class="op">=</span> df[name]</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sr[<span class="op">~</span>sr.isnull()]</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>gene_list_names() <span class="co"># prints names in row 2 (row 1 is descriptive header for the sheet on Google Drive)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>['accel_reg_simiiformes_br',
 'all_npx',
 'all_post_mei_expr',
 'ari_all',
 'ari_nonPUR',
 'ari_relate_AFR',
 'ari_relate_ASIA',
 'ari_relate_EUR',
 'ari_relate_PUR',
 'cDEG',
 'candidates',
 'ech75_regions',
 'ech90_regions',
 'expr_mod_xi_copynr_fibrobl',
 'expr_mod_xi_copynr_lcl',
 'gametologs',
 'hpa_brain_prot',
 'intel_seiz_lang',
 'intelect_disabil',
 'intersection(nDEG, matos_neuron)',
 'matos_common',
 'matos_common_no_xy_gametologs',
 'matos_neuron',
 'meritxell_spermatid_expr',
 'msci',
 'msci_esc',
 'mult_copy',
 'my_primate_codeml',
 'nDEG',
 'neuron_genome_proteome',
 'neuron_npx_proteome',
 'primate_ampl_multi',
 'reg_sa_pheno',
 'sfari_all_conf',
 'union(H,matos_common)',
 'xi',
 'xi_any_evidence',
 'xi_escape',
 'xi_uncertain']</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gene_list_coords(gene_list):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    append_list <span class="op">=</span> []</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gene <span class="kw">in</span> gene_list:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        coord <span class="op">=</span> gi.gene_coord(gene, assembly<span class="op">=</span><span class="st">'hg38'</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> coord:</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            chrom, start, end, strand <span class="op">=</span> gi.gene_coord(gene, assembly<span class="op">=</span><span class="st">'hg38'</span>)[gene]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            append_list.append((chrom, (start <span class="op">+</span> end)<span class="op">/</span><span class="dv">2</span>, gene))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'skipped'</span>, gene)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> append_list</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>xi_escape_genes <span class="op">=</span> gene_list(<span class="st">'xi_escape'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># annot_xi_escape = gene_list_coords(xi_escape_genes)</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>sfari_genes <span class="op">=</span> gene_list(<span class="st">'sfari_all_conf'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># annot_sfari_all_conf = gene_list_coords(sfari_genes)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>cDEG_genes <span class="op">=</span> gene_list(<span class="st">'cDEG'</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># annot_cDEG_genes = gene_list_coords(cDEG_genes)</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>nDEG_genes <span class="op">=</span> gene_list(<span class="st">'nDEG'</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># annot_nDEG_genes = gene_list_coords(nDEG_genes)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>spermatid_expr_genes <span class="op">=</span> gene_list(<span class="st">'meritxell_spermatid_expr'</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>annot_spermatid_expr_genes <span class="op">=</span> gene_list_coords(spermatid_expr_genes)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>accel_reg_genes <span class="op">=</span> gene_list(<span class="st">'accel_reg_simiiformes_br'</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># annot_accel_reg_genes = gene_list_coords(accel_reg_genes)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skipped BHLHB9
skipped CA5BP1-CA5B
skipped CH17-340M24.3
skipped FAM104B
skipped FLJ44635
skipped IDS2
skipped LINC00893
skipped LINC00894
skipped LOC101928128
skipped LOC101928336
skipped LOC101928415
skipped LOC101928437
skipped LOC101928832
skipped LOC102724150
skipped LOC105373133
skipped LOC105373137
skipped LOC105373146
skipped LOC105373150
skipped LOC105373151
skipped LOC105373153
skipped LOC105373154
skipped LOC105373155
skipped LOC105373182
skipped LOC105373184
skipped LOC105373188
skipped LOC105373191
skipped LOC105373194
skipped LOC105373195
skipped LOC105373292
skipped LOC105373298
skipped LOC105373302
skipped LOC105373303
skipped LOC105373313
skipped LOC105373323
skipped LOC105373335
skipped LOC105373347
skipped LOC105373369
skipped LOC105373370
skipped LOC105373383
skipped LOC105373386
skipped LOC105373387
skipped LOC107985634
skipped LOC107985664
skipped LOC107985675
skipped LOC107985678
skipped LOC107985694
skipped LOC107985695
skipped LOC107985698
skipped LOC107985701
skipped LOC107985704
skipped LOC107985707
skipped LOC107985713
skipped LOC107985714
skipped LOC107985717
skipped LOC107985719
skipped LOC112268302
skipped LOC728660
skipped MAGEA10-MAGEA5
skipped MTRNR2L10
skipped PIR-FIGF
skipped amplicon_chrX_CPXCR1_0
skipped amplicon_chrX_CSAG1/2/3_0
skipped amplicon_chrX_CSAG1/2/3_1
skipped amplicon_chrX_CSAG1/2/3_2
skipped amplicon_chrX_CSAG1/2/3_3
skipped amplicon_chrX_CSAG1/2/3_4
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_0
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_1
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_10
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_11
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_12
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_13
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_14
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_15
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_16
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_2
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_3
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_4
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_5
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_6
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_7
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_8
skipped amplicon_chrX_CT45A1/2/3//6/7/8/9/10_9
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_0
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_1
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_10
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_11
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_12
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_13
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_2
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_3
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_4
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_5
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_6
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_7
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_8
skipped amplicon_chrX_CT47A1/2/3/4/5/6/7/8/9/10/11/12/B1_9
skipped amplicon_chrX_CT55_0
skipped amplicon_chrX_CT55_1
skipped amplicon_chrX_CT55_2
skipped amplicon_chrX_CT83_0
skipped amplicon_chrX_CT83_1
skipped amplicon_chrX_CTAG1A/1B/2_0
skipped amplicon_chrX_CTAG1A/1B/2_1
skipped amplicon_chrX_CTAG1A/1B/2_2
skipped amplicon_chrX_CXorf49/B_0
skipped amplicon_chrX_CXorf49/B_1
skipped amplicon_chrX_CXorf49/B_2
skipped amplicon_chrX_CXorf49/B_3
skipped amplicon_chrX_CXorf49/B_4
skipped amplicon_chrX_CXorf49/B_5
skipped amplicon_chrX_CXorf49/B_6
skipped amplicon_chrX_CXorf49/B_7
skipped amplicon_chrX_CXorf51A/B_0
skipped amplicon_chrX_CXorf51A/B_1
skipped amplicon_chrX_DDX53_0
skipped amplicon_chrX_DMRTC1/B/FAM236A/B/C/D_0
skipped amplicon_chrX_EOLA1/2/HSFX3/4_0
skipped amplicon_chrX_EOLA1/2/HSFX3/4_1
skipped amplicon_chrX_ETD1/B/ZNF75D_0
skipped amplicon_chrX_ETD1/B/ZNF75D_1
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_0
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_1
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_2
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_3
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_4
skipped amplicon_chrX_F8/F8A1/2/3/H2AB1/2/3_5
skipped amplicon_chrX_FAM156A/B_0
skipped amplicon_chrX_FAM156A/B_1
skipped amplicon_chrX_FAM47A/B/C_0
skipped amplicon_chrX_FAM47A/B/C_1
skipped amplicon_chrX_FAM47A/B/C_2
skipped amplicon_chrX_G6PD/IKBKG_0
skipped amplicon_chrX_G6PD/IKBKG_1
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_0
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_1
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_10
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_11
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_12
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_2
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_3
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_4
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_5
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_6
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_7
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_8
skipped amplicon_chrX_GAGE10/1/2A/13/12B/12C/12D/12E/12F/12G/12H/12J_9
skipped amplicon_chrX_HSFX1/2_0
skipped amplicon_chrX_HSFX1/2_1
skipped amplicon_chrX_IL3RA/P2RY8/SLC25A6_0
skipped amplicon_chrX_MAGEA12/A2/A2B/A3/A6_0
skipped amplicon_chrX_MAGEA12/A2/A2B/A3/A6_1
skipped amplicon_chrX_MAGEA12/A2/A2B/A3/A6_2
skipped amplicon_chrX_MAGEA12/A2/A2B/A3/A6_3
skipped amplicon_chrX_MAGEA12/A2/A2B/A3/A6_4
skipped amplicon_chrX_MAGEA4_0
skipped amplicon_chrX_MAGEA9/9B_0
skipped amplicon_chrX_MAGEA9/9B_1
skipped amplicon_chrX_MAGEB6_0
skipped amplicon_chrX_MAGEB6_1
skipped amplicon_chrX_MAGEC1_0
skipped amplicon_chrX_MBTPS2/YY2_0
skipped amplicon_chrX_MBTPS2/YY2_1
skipped amplicon_chrX_NSDHL_0
skipped amplicon_chrX_NUDT10/11_0
skipped amplicon_chrX_NUDT10/11_1
skipped amplicon_chrX_NXF2/2B/5_0
skipped amplicon_chrX_NXF2/2B/5_1
skipped amplicon_chrX_NXF2/2B/5_2
skipped amplicon_chrX_PABPC1L2A/B_0
skipped amplicon_chrX_PABPC1L2A/B_1
skipped amplicon_chrX_PAGE2/2B/5_0
skipped amplicon_chrX_PAGE2/2B/5_1
skipped amplicon_chrX_PAGE2/2B/5_2
skipped amplicon_chrX_PAGE2/2B/5_3
skipped amplicon_chrX_RHOXF2/B_0
skipped amplicon_chrX_RHOXF2/B_1
skipped amplicon_chrX_SPACA5/B_0
skipped amplicon_chrX_SPACA5/B_1
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_0
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_1
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_2
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_3
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_4
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_5
skipped amplicon_chrX_SPANXA1/A2/N1/N2/N3/N4/N5/B1/C/D_6
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_0
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_1
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_10
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_11
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_12
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_13
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_14
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_15
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_16
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_17
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_18
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_19
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_2
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_20
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_21
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_22
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_23
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_24
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_25
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_26
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_27
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_28
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_29
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_3
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_30
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_31
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_4
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_5
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_6
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_7
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_8
skipped amplicon_chrX_SSX1/2/2B/344B/5/7_9
skipped amplicon_chrX_SUPT20HL1/2_0
skipped amplicon_chrX_SUPT20HL1/2_1
skipped amplicon_chrX_TCEAL2/3/4/5/6_0
skipped amplicon_chrX_TCEAL2/3/4/5/6_1
skipped amplicon_chrX_TCEAL2/3/4/5/6_2
skipped amplicon_chrX_TCEAL2/3/4/5/6_3
skipped amplicon_chrX_TCEAL2/3/4/5/6_4
skipped amplicon_chrX_TCP11X1/2_0
skipped amplicon_chrX_TCP11X1/2_1
skipped amplicon_chrX_TCP11X1/2_2
skipped amplicon_chrX_TCP11X1/2_3
skipped amplicon_chrX_TEX28_0
skipped amplicon_chrX_TEX28_1
skipped amplicon_chrX_TEX28_2
skipped amplicon_chrX_TMEM185A_0
skipped amplicon_chrX_TMEM185A_1
skipped amplicon_chrX_VCX/2/3A/3B_0
skipped amplicon_chrX_VCX/2/3A/3B_1
skipped amplicon_chrX_VCX/2/3A/3B_2
skipped amplicon_chrX_VCX/2/3A/3B_3
skipped amplicon_chrX_XAGE1A/B_0
skipped amplicon_chrX_XAGE1A/B_1
skipped amplicon_chrX_XAGE3_0
skipped amplicon_chrX_XAGE3_1
skipped amplicon_chrX_XAGE3_2
skipped amplicon_chrX_XAGE5_0
skipped amplicon_chrX_XAGE5_1</code></pre>
</div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>append_gene_list_coords(annot, nDEG_genes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # for gene in gene_list('cDEG'):</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># #     chrom, start, end, strand = gi.gene_coord(gene, assembly='hg38')[gene]</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #     annot.append((chrom, (start + end)/2, gene, 'red'))</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for gene in gene_list('sfari_all_conf'):</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     chrom, start, end, strand = gi.gene_coord(gene, assembly='hg38')[gene]</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     # annot.append((chrom, (start + end)/2, gene, 'blue'))</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     annot.append((chrom, (start + end)/2, gene))    </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for gene in gene_list('xi_escape'):</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     chrom, start, end, strand = gi.gene_coord(gene, assembly='hg38')[gene]</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     # annot.append((chrom, (start + end)/2, gene, 'green'))</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     annot.append((chrom, (start + end)/2, gene))</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for gene in spermatid_expr_genes:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     coord = gi.gene_coord(gene, assembly='hg38')</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     if coord:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         chrom, start, end, strand = gi.gene_coord(gene, assembly='hg38')[gene]</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         # annot.append((chrom, (start + end)/2, gene, 'purple'))</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         annot.append((chrom, (start + end)/2, gene))s</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         print('skipped', gene)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>annot <span class="op">=</span> annot_spermatid_expr_genes</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>annot <span class="op">=</span> [a[:<span class="dv">3</span>] <span class="cf">for</span> a <span class="kw">in</span> annot <span class="cf">if</span> a[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'chrX'</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>annot <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(<span class="bu">set</span>(annot)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sample <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Fs <span class="op">=</span> <span class="dv">153000000</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.linspace(<span class="dv">5</span>, <span class="dv">50</span>, sample)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, Fs, sample)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span> np.pi <span class="op">*</span> f <span class="op">*</span> x <span class="op">/</span> Fs)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>chrom <span class="op">=</span> [<span class="st">'chrX'</span>]<span class="op">*</span>sample</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>(x<span class="op">=</span>x, y<span class="op">=</span>y, chrom<span class="op">=</span>chrom)).sort_values(<span class="st">'x'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'start'</span>] <span class="op">=</span> df.x.shift()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'end'</span>] <span class="op">=</span> df.x</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.iloc[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, :]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> stairs(df)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">chrom</th>
<th data-quarto-table-cell-role="th">start</th>
<th data-quarto-table-cell-role="th">end</th>
<th data-quarto-table-cell-role="th">pos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>153153.153153</td>
<td>0.031725</td>
<td>chrX</td>
<td>0.000000</td>
<td>153153.153153</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>153153.153153</td>
<td>0.031725</td>
<td>chrX</td>
<td>0.000000</td>
<td>153153.153153</td>
<td>153153.153153</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>306306.306306</td>
<td>0.063984</td>
<td>chrX</td>
<td>153153.153153</td>
<td>306306.306306</td>
<td>153153.153153</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>306306.306306</td>
<td>0.063984</td>
<td>chrX</td>
<td>153153.153153</td>
<td>306306.306306</td>
<td>306306.306306</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>459459.459459</td>
<td>0.096740</td>
<td>chrX</td>
<td>306306.306306</td>
<td>459459.459459</td>
<td>306306.306306</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 4))</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ax1.scatter(df.x, df.y, s=5)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add_lowess(df.x, df.y, ax=ax1, frac=0.02)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ax2.plot(df.pos, df.y)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ##########################################################################################</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # interface</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ##########################################################################################</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ci = ChromIdeogram('chr1', axes_width_inches=18, axes_height_inches=3, ylim=(0, 2), rel_font_height=0.03) # plots chromosome</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # ci.draw_chromosomes(base=1, height=0.10, facecolor='lightgray')</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.draw_chromosomes(base=0, height=0.1, facecolor='none')</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.map_fun(horizonplot, data=df, y='y', yaxis=(0, 0.3))</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.add_labels(annot)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>horizonplot(df, y<span class="op">=</span><span class="st">'y'</span>, x<span class="op">=</span><span class="st">'x'</span>, offset<span class="op">=</span><span class="dv">0</span>, height<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_axis_off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-27-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="chrom_ideograms-Copy2_files/figure-html/cell-27-output-1.png" width="831" height="141" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> ChromIdeogram(<span class="st">'chrX'</span>, axes_width_inches<span class="op">=</span><span class="dv">18</span>, axes_height_inches<span class="op">=</span><span class="dv">4</span>, ylim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">10</span>), </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                   rel_font_height<span class="op">=</span><span class="fl">0.01</span>, hspace<span class="op">=</span><span class="fl">0.2</span>, wspace<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                   zooms<span class="op">=</span>[(<span class="dv">45_000_000</span>, <span class="dv">55_000_000</span>), </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># (65_000_000, 90_000_000), </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                           (<span class="dv">115_000_000</span>, <span class="dv">125_000_000</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                         ]) </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ci.draw_chromosomes(base<span class="op">=</span><span class="fl">3.5</span>, height<span class="op">=</span><span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.add_labels(annot, </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#               colored = xi_escape_genes,</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#               bold = accel_reg_genes,</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># #              italic = spermatid_expr_genes,</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">#               filled = cDEG_genes,</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># #              bold = nDEG_genes + nDEG_genes,</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">#               # bold=['ZNF711', 'COX7B', 'PGK1'], </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#               # italic = ['TBX22'], </span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#               # colored = ['NEXMIF', 'ATRX'],</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#               # framed = ['MAOA', 'ATRX'],</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#               # filled = ['PCDH19', 'ATRX'],</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">#              )</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.map_fun(horizonplot, data=df, x='x', y='y', offset=0, height=1000000)</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>ci.horizon(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, base<span class="op">=</span><span class="fl">3.5</span>, height<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">25e6</span>, <span class="fl">55e6</span>), </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">98e6</span>, <span class="fl">102e6</span>)], label<span class="op">=</span><span class="st">'segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">115e6</span>, <span class="fl">135e6</span>)], facecolor<span class="op">=</span><span class="st">'red'</span>, base<span class="op">=</span><span class="fl">3.5</span>, height<span class="op">=</span><span class="fl">0.25</span>, label<span class="op">=</span><span class="st">'red segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">125e6</span>, <span class="fl">145e6</span>)], facecolor<span class="op">=</span><span class="st">'green'</span>, base<span class="op">=</span><span class="fl">3.75</span>, height<span class="op">=</span><span class="fl">0.25</span>, label<span class="op">=</span><span class="st">'green segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">35e6</span>, <span class="fl">45e6</span>), </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">100e6</span>, <span class="fl">102e6</span>), </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">120e6</span>, <span class="fl">132e6</span>)], facecolor<span class="op">=</span><span class="st">'blue'</span>, base<span class="op">=</span><span class="dv">3</span>, height<span class="op">=</span><span class="fl">0.25</span>, label<span class="op">=</span><span class="st">'blue segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>ci.add_vlines()</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>ci.map_fun(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), s<span class="op">=</span><span class="dv">5</span>, c<span class="op">=</span><span class="st">'C1'</span>, label<span class="op">=</span><span class="st">'seaborn'</span>)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>ci.map_method(Axes.scatter, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">1.5</span>, <span class="fl">2.4</span>), s<span class="op">=</span><span class="dv">5</span>, c<span class="op">=</span><span class="st">'C2'</span>, label<span class="op">=</span><span class="st">'matplotlib'</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>ci.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-28-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="chrom_ideograms-Copy2_files/figure-html/cell-28-output-1.png" width="1629" height="731" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="397">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># interface</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> ChromIdeogram(<span class="st">'chrX'</span>, axes_width_inches<span class="op">=</span><span class="dv">18</span>, axes_height_inches<span class="op">=</span><span class="dv">3</span>, ylim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">3</span>), rel_font_height<span class="op">=</span><span class="fl">0.03</span>) <span class="co"># plots chromosome</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ci.draw_chromosomes(base=1, height=0.10, facecolor='lightgray')</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>ci.draw_chromosomes(base<span class="op">=</span><span class="dv">1</span>, height<span class="op">=</span><span class="fl">0.20</span>, facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ci.add_labels(annot)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">25e6</span>, <span class="fl">55e6</span>), </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">98e6</span>, <span class="fl">102e6</span>)], label<span class="op">=</span><span class="st">'segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">115e6</span>, <span class="fl">135e6</span>)], facecolor<span class="op">=</span><span class="st">'red'</span>, base<span class="op">=</span><span class="dv">1</span>, height<span class="op">=</span><span class="fl">0.1</span>, label<span class="op">=</span><span class="st">'red segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">125e6</span>, <span class="fl">145e6</span>)], facecolor<span class="op">=</span><span class="st">'green'</span>, base<span class="op">=</span><span class="fl">1.1</span>, height<span class="op">=</span><span class="fl">0.1</span>, label<span class="op">=</span><span class="st">'green segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>ci.add_segments([(<span class="st">'chrX'</span>, <span class="fl">35e6</span>, <span class="fl">45e6</span>), </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">100e6</span>, <span class="fl">102e6</span>), </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                 (<span class="st">'chrX'</span>, <span class="fl">120e6</span>, <span class="fl">132e6</span>)], facecolor<span class="op">=</span><span class="st">'blue'</span>, base<span class="op">=</span><span class="fl">0.8</span>, height<span class="op">=</span><span class="fl">0.1</span>, label<span class="op">=</span><span class="st">'blue segments'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>ci.add_vlines()</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># plot using function that takes data and column name keyword args for dimensions (like seaborn's sns.scatterplot)</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>ci.map_fun(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>), s<span class="op">=</span><span class="dv">5</span>, c<span class="op">=</span><span class="st">'C1'</span>, label<span class="op">=</span><span class="st">'seaborn'</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot using matplotlib Axes method that x and y positional arguments (like matplotlib's Axes.scatter)</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>ci.map_method(Axes.scatter, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>), s<span class="op">=</span><span class="dv">5</span>, c<span class="op">=</span><span class="st">'C2'</span>, label<span class="op">=</span><span class="st">'matplotlib'</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>ci.legend()</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co"># add axis</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>new_ax, new_ax2, new_ax3 <span class="op">=</span> ci.add_axes(<span class="dv">3</span>, height_ratio<span class="op">=</span><span class="fl">0.3</span>, hspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>new_ax.vlines(<span class="bu">list</span>(<span class="bu">range</span>(<span class="op">*</span><span class="bu">map</span>(<span class="bu">int</span>, new_ax.get_xlim()), <span class="dv">2_000_000</span>)), <span class="op">*</span>new_ax.get_ylim(), color<span class="op">=</span><span class="st">'gray'</span>, linewidth<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="co"># new_ax.plot(np.linspace(*new_ax.get_xlim(), 100), np.random.random(100), label='Line')</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>_df <span class="op">=</span> stairs(df)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>new_ax.plot(_df.pos, _df.y, label<span class="op">=</span><span class="st">'Stairs'</span>)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>new_ax.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), fontsize<span class="op">=</span><span class="st">"10"</span>, frameon<span class="op">=</span><span class="va">False</span>) <span class="op">;</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co"># new_ax2.scatter(np.linspace(*new_ax.get_xlim(), 100), np.random.random(100), s=5, label='Scatter')</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>new_ax2.scatter(df.x, df.y, s<span class="op">=</span><span class="dv">5</span>, c<span class="op">=</span><span class="st">'black'</span>,label<span class="op">=</span><span class="st">'Scatter'</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>add_lowess(df.x, df.y, ax<span class="op">=</span>new_ax2, frac<span class="op">=</span><span class="fl">0.02</span>, c<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Lowess'</span>)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>new_ax2.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), fontsize<span class="op">=</span><span class="st">"10"</span>, frameon<span class="op">=</span><span class="va">False</span>) <span class="op">;</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>horizonplot(df, y<span class="op">=</span><span class="st">'y'</span>, ax<span class="op">=</span>new_ax3)</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co"># info annotation</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co">##########################################################################################</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.text <span class="im">import</span> OffsetFrom</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>strs <span class="op">=</span> <span class="st">"DYNLT3: lka dflaks dlfkajs ldkajs dlfkajsd fasdfasdfl lakjsd las dflasd jflaksdj flaksjdf laksdjf laksdjf a flaksdj fla"</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>annot_kwargs<span class="op">=</span><span class="bu">dict</span>(fontsize<span class="op">=</span><span class="dv">5</span>, ha<span class="op">=</span><span class="st">"left"</span>, va<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># fc="0.97", </span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>                 fc<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>                 ec<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># alpha=0.2, </span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>                 linewidth<span class="op">=</span><span class="fl">0.7</span>),</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>    arrowprops<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">'red'</span>, <span class="co"># color of arrow</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>        shrink<span class="op">=</span><span class="fl">0.01</span>, <span class="co"># distance from point</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="fl">1.5</span>, <span class="co"># width of arrow</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>        headwidth<span class="op">=</span><span class="dv">5</span>, <span class="co"># width of arrow head</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>        headlength<span class="op">=</span><span class="dv">7</span>, <span class="co"># length of arrow head</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>        connectionstyle<span class="op">=</span><span class="st">"angle3,angleA=0,angleB=-90"</span>, </span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># alpha=0.7,</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>             <span class="co"># arrowprops=dict(facecolor='red', arrowstyle="fancy", </span></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>             <span class="co">#                 connectionstyle="angle3,angleA=0,angleB=-90", alpha=0.9)</span></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>ci.ax.annotate(textwrap.fill(strs, <span class="dv">40</span>), xy<span class="op">=</span>(<span class="dv">60000000</span>, ci.map_y(<span class="fl">1.2</span>, ci.ax)), xytext<span class="op">=</span>(<span class="dv">30000000</span>, ci.map_y(<span class="fl">3.1</span>, ci.ax)), xycoords<span class="op">=</span><span class="st">"data"</span>, textcoords<span class="op">=</span><span class="st">"data"</span>, <span class="op">**</span>annot_kwargs)</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>ci.ax.annotate(textwrap.fill(strs, <span class="dv">40</span>), xy<span class="op">=</span>(<span class="dv">120000000</span>, ci.map_y(<span class="fl">1.2</span>, ci.ax)), xytext<span class="op">=</span>(<span class="dv">100000000</span>, ci.map_y(<span class="fl">3.1</span>, ci.ax)), xycoords<span class="op">=</span><span class="st">"data"</span>, textcoords<span class="op">=</span><span class="st">"data"</span>, <span class="op">**</span>annot_kwargs) <span class="op">;</span></span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>new_ax.annotate(textwrap.fill(strs, <span class="dv">40</span>), xy<span class="op">=</span>(<span class="fl">0.8</span>, <span class="fl">0.7</span>), xytext<span class="op">=</span>(<span class="dv">800</span>, <span class="dv">200</span>), xycoords<span class="op">=</span><span class="st">"axes fraction"</span>,</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>             textcoords<span class="op">=</span>OffsetFrom(ax.bbox, (<span class="dv">0</span>, <span class="dv">0</span>), <span class="st">"points"</span>), <span class="op">**</span>annot_kwargs) <span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-29-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="chrom_ideograms-Copy2_files/figure-html/cell-29-output-1.png" width="1628" height="608" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="394">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.transforms <span class="im">import</span> (Bbox, TransformedBbox,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                                   blended_transform_factory)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> (BboxConnector,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                                                   BboxConnectorPatch,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                                                   BboxPatch)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_bbox(bbox1, bbox2,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                 loc1a, loc2a, loc1b, loc2b,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                 prop_lines, prop_patches<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prop_patches <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        prop_patches <span class="op">=</span> {</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>prop_lines,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"alpha"</span>: prop_lines.get(<span class="st">"alpha"</span>, <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.2</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"clip_on"</span>: <span class="va">False</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    c1 <span class="op">=</span> BboxConnector(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        bbox1, bbox2, loc1<span class="op">=</span>loc1a, loc2<span class="op">=</span>loc2a, clip_on<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>prop_lines)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    c2 <span class="op">=</span> BboxConnector(</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        bbox1, bbox2, loc1<span class="op">=</span>loc1b, loc2<span class="op">=</span>loc2b, clip_on<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>prop_lines)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    bbox_patch1 <span class="op">=</span> BboxPatch(bbox1, ec<span class="op">=</span><span class="st">'none'</span>, fc<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    bbox_patch2 <span class="op">=</span> BboxPatch(bbox2, <span class="op">**</span>prop_patches)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> BboxConnectorPatch(bbox1, bbox2,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>                           loc1a<span class="op">=</span>loc1a, loc2a<span class="op">=</span>loc2a, loc1b<span class="op">=</span>loc1b, loc2b<span class="op">=</span>loc2b,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>                           clip_on<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>                           <span class="op">**</span>prop_patches)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c1, c2, bbox_patch1, bbox_patch2, p</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> zoom_effect(ax1, ax2, <span class="op">**</span>kwargs):</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co">    ax1 : the main Axes</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co">    ax1 : the zoomed Axes</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="co">    Similar to zoom_effect01.  The xmin &amp; xmax will be taken from the</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="co">    ax1.viewLim.</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    tt <span class="op">=</span> ax1.transScale <span class="op">+</span> (ax1.transLimits <span class="op">+</span> ax2.transAxes)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    trans <span class="op">=</span> blended_transform_factory(ax2.transData, tt)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>    mybbox1 <span class="op">=</span> ax1.bbox</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>    mybbox2 <span class="op">=</span> TransformedBbox(ax1.viewLim, trans)</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    prop_patches <span class="op">=</span> {<span class="op">**</span>kwargs, <span class="st">'ec'</span>: <span class="st">'black'</span>, <span class="st">'fc'</span>: <span class="st">'lightgray'</span>, <span class="st">'alpha'</span>: <span class="fl">0.3</span>, <span class="st">'linewidth'</span>: <span class="fl">0.5</span>}</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>    c1, c2, bbox_patch1, bbox_patch2, p <span class="op">=</span> connect_bbox(</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>        mybbox1, mybbox2,</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>        loc1a<span class="op">=</span><span class="dv">2</span>, loc2a<span class="op">=</span><span class="dv">3</span>, loc1b<span class="op">=</span><span class="dv">1</span>, loc2b<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>        prop_lines<span class="op">=</span>kwargs, prop_patches<span class="op">=</span>prop_patches)</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    ax1.add_patch(bbox_patch1)</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>    ax2.add_patch(bbox_patch2)</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    ax2.add_patch(c1)</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>    ax2.add_patch(c2)</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>    ax2.add_patch(p)</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c1, c2, bbox_patch1, bbox_patch2, p</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>axs <span class="op">=</span> plt.figure().subplot_mosaic([</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"main"</span>, <span class="st">"main"</span>],</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"zoom1"</span>, <span class="st">"zoom2"</span>],</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>axs[<span class="st">"main"</span>].<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>zoom_effect(axs[<span class="st">"zoom1"</span>], axs[<span class="st">"main"</span>])</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>axs[<span class="st">"zoom1"</span>].<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>axs[<span class="st">"zoom2"</span>].<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>zoom_effect(axs[<span class="st">"zoom2"</span>], axs[<span class="st">"main"</span>])</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-30-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="chrom_ideograms-Copy2_files/figure-html/cell-30-output-1.png" width="554" height="417" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<section id="the-issue-seems-to-be-that-i-compute-ylimits-using-the-input-data-to-horizonplot-not-the-data-it-plots" class="level1">
<h1>the issue seems to be that I compute ylimits using the input data to horizonplot, not the data it plots…</h1>
<div id="cell-35" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> gridspec</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DrawExample():</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, initial_data) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Constructs a DrawExample for one column and multiple rows.</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Note that subplots are added to the bottom.</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fig <span class="op">=</span> plt.figure()</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Start with one subplot</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.row <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> <span class="va">self</span>.fig.add_subplot(<span class="va">self</span>.row, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        ax.plot(initial_data)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_bottom(<span class="va">self</span>, data: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Plots the data to a new subplot at the bottom."""</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.row <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        gs <span class="op">=</span> gridspec.GridSpec(<span class="va">self</span>.row, <span class="dv">1</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reposition existing subplots</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.fig.axes):</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>            ax.set_position(gs[i].get_position(<span class="va">self</span>.fig))</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            ax.set_subplotspec(gs[i])</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add new subplot</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        new_ax <span class="op">=</span> <span class="va">self</span>.fig.add_subplot(gs[<span class="va">self</span>.row<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        new_ax.plot(data)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> show(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>draw <span class="op">=</span> DrawExample([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>draw.plot_bottom([<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">100</span>])</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>draw.plot_bottom([<span class="dv">10</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>draw.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-31-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="chrom_ideograms-Copy2_files/figure-html/cell-31-output-1.png" width="548" height="412" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> GenomeIdeogram() <span class="co"># plots chromosome</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ci.draw_chromosomes(base<span class="op">=</span><span class="fl">0.05</span>, height<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ci.add_labels(annot, y0<span class="op">=</span><span class="fl">0.2</span>, y1<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ci.map(plt.scatter, data=df, x='x', y='y', yaxis=(0.5, 0.7))</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ci.map_dataframe(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>), s<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ci.map_dataframe(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.6</span>, <span class="fl">0.8</span>), s<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>ci.map_dataframe(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.8</span>, <span class="fl">1.0</span>), s<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>ci.map_dataframe(sns.scatterplot, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, yaxis<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.25</span>), s<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-32-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="chrom_ideograms-Copy2_files/figure-html/cell-32-output-1.png" width="983" height="1709" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="799">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import math</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from matplotlib.artist import Artist</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># axes_height = 1e4 # relative to length of chrom one</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># max_chrom_size = 1e5</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># aspect = axes_height / chrom_size</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fig_width_inches = 8</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># axes_height_inches = fig_width * aspect</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fig_height = axes_height_inches * nr_rows</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># nr_rows = 11</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(nr_rows, 1, figsize=(fig_width, fig_width*aspect*nr_rows), sharex=True, sharey=True)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.subplots_adjust(hspace=0)</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ax = axes[0]</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># xlim = (0, max_chrom_size)</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ylim = (0, 6)</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co"># scaled_y_lim = xlim[0] * aspect, xlim[1] * aspect</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_xlim(xlim)</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_ylim(scaled_y_lim)</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.yticks([])</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># y_unit = -sub(*scaled_y_lim) / -sub(*ylim)</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># rel_font_height = 0.1</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co"># font_size = rel_font_height * axes_height_inches / point_size</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co"># def draw_text(x_pos, y_pos, text, font_size, rel_font_height, ax, y_line_bottom=0):</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax.text(x_pos, y_pos, 'Tester', fontsize=font_size, </span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                 horizontalalignment='left',# weight='bold',</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                 verticalalignment='bottom', </span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                 rotation=45, zorder=3, </span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bbox=dict(boxstyle='square,pad=0', fc='none', ec='none'))</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     (_, a), (_, b) = ax.transAxes.transform([(0, 0), (0, rel_font_height / 2)])</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     z = b - a    </span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     z = 300</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     z = y_unit/6</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax.plot((x_pos, x_pos, x_pos+z),</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="co">#             (y_line_bottom, y_pos, y_pos+z), </span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="co">#             linewidth=0.5, color='gray')</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="co"># def get_polygon(text:str, x_pos:int, y_pos:float, font_size:float, ax:matplotlib.axes.Axes) -&gt; Polygon:</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     y_pos = y_pos * y_unit</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     # x_pos, y_pos = chrom_size/2, 2*y_unit</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     # ax.scatter([x_pos], [y_pos], marker='X', color='black')</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="co">#     t = ax.text(x_pos, y_pos, 'Tester', fontsize=font_size, </span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="co">#                 horizontalalignment='left',# weight='bold',</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="co">#                 verticalalignment='bottom', </span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="co">#                 rotation=0, zorder=3, </span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bbox=dict(boxstyle='square,pad=0', fc='none', ec='none', alpha=0.4))</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     # t.set_visible(False)</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     transf = ax.transData.inverted()</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="co">#     bb = t.get_window_extent(renderer = fig.canvas.get_renderer())</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="co">#     bbt = bb.transformed(transf)</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = bbt.get_points()</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     Artist.remove(t)</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     (x0, y0), (x1, y1) = coords</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     # ax.scatter(*coords.T, c='red')</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     # ax.scatter(*zip(*coords), transform=ax.transAxes, s=1, color='green', zorder=3)</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="co">#     x, y = zip(*coords)</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     df = pd.DataFrame(dict(x=x, y=y))</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['y'] -= y_pos</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['x'] -= x_pos</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="co">#     dfx = df['x']*math.cos(math.radians(45))-df['y']*math.sin(math.radians(45))</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['y'] = df['x']*math.sin(math.radians(45))+df['y']*math.cos(math.radians(45))</span></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['x'] = dfx</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['y'] += y_pos</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="co">#     df['x'] += x_pos</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="co">#     #df['x'] -= df['x'][1] - df['x'][0]</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = np.array(list(zip(df.x, df.y)))</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="co">#     x_pos, y_pos = df['x'][0] - (df['x'][0] - df['x'][1]), df['y'][0]</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a><span class="co">#     # _ = ax.text(x_pos, y_pos, 'Tester', fontsize=font_size, </span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a><span class="co">#     #             horizontalalignment='left',# weight='bold',</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="co">#     #             verticalalignment='bottom', </span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="co">#     #             rotation=45, zorder=3, </span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="co">#     #             bbox=dict(boxstyle='square,pad=0', fc='none', ec='none'))</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     # ax.scatter(*coords.T, c='blue')</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="co">#     # ax.plot(*zip(*coords), linewidth=0.2)</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="co">#     return x_pos, y_pos, Polygon([Point(x, y) for x, y in zip(df.x, df.y)])</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="co"># annot = [(x, 'AKAP4') for x in range(1, int(max_chrom_size), int(max_chrom_size/200))]</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, ax in enumerate(axes):</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a><span class="co">#     annot = [(x, 'AKAP4') for x in range(1, int(max_chrom_size), int(max_chrom_size/(10*(i+1))))]</span></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="co">#     polybuff = []</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="co">#     for pos, name in annot:</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a><span class="co">#         x, y, poly = get_polygon(name, pos, 1, rel_font_height, ax)</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a><span class="co">#         while any(is_polygons_intersecting(poly, p) for p in polybuff):</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="co">#             nudge = 0.1 * y_unit</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="co">#             y += nudge</span></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a><span class="co">#             poly.nudge_y(nudge)</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a><span class="co">#         draw_text(x, y, name, font_size, rel_font_height, ax)</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="co">#         if len(polybuff) &gt; 5:</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a><span class="co">#             del polybuff[0]</span></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="co">#         polybuff.append(poly)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell" data-execution_count="559">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.transforms</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.transforms <span class="im">import</span> Bbox</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ax.text(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="st">'Text'</span>, fontsize<span class="op">=</span><span class="dv">30</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>,<span class="co"># weight='bold',</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                         verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, rotation<span class="op">=</span><span class="dv">0</span>, zorder<span class="op">=</span><span class="dv">3</span>, bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, fc<span class="op">=</span><span class="st">'red'</span>, ec<span class="op">=</span><span class="st">'none'</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>transf <span class="op">=</span> ax.transData.inverted()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>bb <span class="op">=</span> t.get_window_extent(renderer <span class="op">=</span> fig.canvas.get_renderer())</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>bbt <span class="op">=</span> bb.transformed(transf)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> bbt.get_points()</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coords)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>(x0, y0), (x1, y1) <span class="op">=</span> coords</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>plt_coords <span class="op">=</span> np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>plt_coords.T, c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> sub</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>aspect_ratio <span class="op">=</span> sub(<span class="op">*</span>ax.get_ylim()) <span class="op">/</span> sub(<span class="op">*</span>ax.get_xlim())</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co">#x0, y0 = coords[0]</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># (x0, y0), (x1, y2) = coords</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>trafo <span class="op">=</span> matplotlib.transforms.Affine2D().rotate_deg_around(x0,y0,<span class="dv">45</span>).skew(<span class="dv">1</span>, <span class="fl">1.3</span>)<span class="co">#.scale(0.5)</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> trafo.transform([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="co"># coords = trafo.transform([(x0, y0), (x1, y1)])</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># coords = trafo.transform(coords)</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coords)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>coords.T, zorder<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>disp_ratio <span class="op">=</span> ax.get_data_ratio()</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> ax.get_window_extent().transformed(fig.dpi_scale_trans.inverted())</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>disp_ratio <span class="op">=</span> bbox.width <span class="op">/</span> bbox.height</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(disp_ratio)</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>(x0, y0), (x0, y1), (x1, y1), (x1, y0) <span class="op">=</span> coords</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>coords.T)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>Polygon([Point(x0, y0), Point(bbt.xmin, b[<span class="dv">1</span>]<span class="op">+</span>(b[<span class="dv">0</span>]<span class="op">-</span>bbt.xmin)), Point(b[<span class="dv">2</span>], b[<span class="dv">3</span>]), Point(bbt.xmax, b[<span class="dv">3</span>]<span class="op">-</span>(b[<span class="dv">0</span>]<span class="op">-</span>bbt.xmin))])</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Bbox.count_overlaps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.2        0.2       ]
 [0.27711694 0.30281385]]
[[0.51148154 0.92042049]
 [0.55200529 0.73124667]
 [0.6914605  0.9821989 ]
 [0.65093675 1.17137271]]
1.3419913419913418</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-34-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="chrom_ideograms-Copy2_files/figure-html/cell-34-output-2.png" width="554" height="417" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="560">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> patches</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.transforms <span class="im">as</span> transforms</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># [[0.25574077 0.46021024]</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  [0.29626452 0.27103643]</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  [0.43571973 0.52198865]</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  [0.39519598 0.71116247]]</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [[0.1        0.1       ]</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  [0.17711694 0.20281385]]</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> patches.Rectangle((<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="fl">0.2</span>, <span class="fl">0.1</span>, color<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> patches.Rectangle((<span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="fl">0.2</span>, <span class="fl">0.1</span>, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.1</span>, <span class="fl">0.1</span> <span class="co"># rotate around this point</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>x_lim <span class="op">=</span> (<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>y_lim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(x_lim)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(y_lim)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>x_range <span class="op">=</span> x_lim[<span class="dv">1</span>] <span class="op">-</span> x_lim[<span class="dv">0</span>]</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>y_range <span class="op">=</span> y_lim[<span class="dv">1</span>] <span class="op">-</span> y_lim[<span class="dv">0</span>]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>aspect_ratio <span class="op">=</span> y_range <span class="op">/</span> x_range</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>move_transform <span class="op">=</span> transforms.Affine2D().translate(<span class="op">-</span>p[<span class="dv">0</span>], <span class="op">-</span>p[<span class="dv">1</span>])</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>inverse_move_transform <span class="op">=</span> transforms.Affine2D().translate(p[<span class="dv">0</span>], p[<span class="dv">1</span>])</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>inverse_scale_transform <span class="op">=</span> transforms.Affine2D().scale(<span class="dv">1</span>, <span class="dv">1</span> <span class="op">/</span> aspect_ratio)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>rotate_transform <span class="op">=</span> transforms.Affine2D().rotate_deg(<span class="dv">45</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>scale_transform <span class="op">=</span> transforms.Affine2D().scale(<span class="dv">1</span>, aspect_ratio)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>total_transform <span class="op">=</span> move_transform <span class="op">+</span> inverse_scale_transform <span class="op">+</span> rotate_transform <span class="op">+</span> scale_transform <span class="op">+</span> inverse_move_transform <span class="op">+</span> ax.transData</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>r2.set_transform(total_transform)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>ax.add_patch(r1)</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>ax.add_patch(r2)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="co"># print(ax.transLimits.transform([(0.1, 0.1), (0.1, 0.2), (0.3, 0.2), (0.3, 0.1)]))</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># print(total_transform.transform([(0.1, 0.1), (0.1, 0.2), (0.3, 0.2), (0.3, 0.1)]))</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="co"># print(r2.get_bbox())</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="co"># x0, y0, width, height = r2.get_bbox().bounds()</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="co"># print(x0, y0)</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="co"># coords = [(x0, y0), </span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="co">#           (x0 - sqrt(height**2 / 2), y0 + sqrt(height**2 / 2)), </span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="co">#           (x0 - sqrt(height**2 / 2) + sqrt(width**2 / 2), y0 + sqrt(height**2 / 2)) +  + sqrt(width**2 / 2), </span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="co">#           (x0 + sqrt(width**2 / 2), y0 + sqrt(width**2 / 2))]</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(*zip(*coords))</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a><span class="co"># coords = ((0.1, 0.1), (0.1, 0.2), (0.3, 0.2), (0.3, 0.1))</span></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(*zip(*coords))</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="co"># coords = total_transform.transform(coords)</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="co"># print(coords)</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(*zip(*coords))</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-35-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="chrom_ideograms-Copy2_files/figure-html/cell-35-output-1.png" width="554" height="417" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-40" class="cell" data-execution_count="365">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> patches</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#some helper values</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span><span class="dv">4</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>theta<span class="op">=</span>pi<span class="op">/</span><span class="dv">6</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> p<span class="op">*</span>cos(theta<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> p<span class="op">*</span>sin(theta<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>vertices <span class="op">=</span>[(<span class="op">-</span>x1<span class="op">-</span>p<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>), (<span class="op">-</span>p<span class="op">/</span><span class="dv">2</span>, y1), (p<span class="op">/</span><span class="dv">2</span>, y1), (x1<span class="op">+</span>p<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>), (p<span class="op">/</span><span class="dv">2</span>, <span class="op">-</span>y1), (<span class="op">-</span>p<span class="op">/</span><span class="dv">2</span>, <span class="op">-</span>y1)] </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>midPoint <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">4</span>]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>endPoint <span class="op">=</span> (<span class="op">-</span>x1<span class="op">-</span>p<span class="op">/</span><span class="dv">2</span>,<span class="dv">0</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#set up the plot</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#function to rotate and translate the standard shape to a new position</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_polygon(vertices, midPoint, theta, color):</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    polygon <span class="op">=</span> patches.Polygon(vertices, color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.50</span>) </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> mpl.transforms.Affine2D().rotate_around(midPoint[<span class="dv">0</span>],midPoint[<span class="dv">1</span>], theta)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># t = mpl.transforms.Affine2D().translate(midPoint[0],midPoint[1])</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    tra <span class="op">=</span> r <span class="op">+</span> ax.transData</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># r = mpl.transforms.Affine2D().rotate(theta)</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># t = mpl.transforms.Affine2D().translate(midPoint[0],midPoint[1])</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tra = r + t + ax.transData</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    polygon.set_transform(tra)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    ax.add_patch(polygon)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r.transform(polygon.xy)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> plot_polygon(vertices, endPoint, <span class="dv">0</span>, <span class="st">"blue"</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_polygon(vertices, midPoint, theta, "blue")</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>p_ <span class="op">=</span> plot_polygon(vertices, endPoint, theta, <span class="st">"orange"</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p.get_xy())</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p_.get_xy())</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p.get_transform().transform(p.xy))</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="co"># print(p_.get_transform().transform(p_.xy))</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="co">#The correct answer is: tra.transform(poly.xy)</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>p), color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>p_), color<span class="op">=</span><span class="st">'orange'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.xlim(-10, 10)</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ylim(-10, 10)</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-36-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="chrom_ideograms-Copy2_files/figure-html/cell-36-output-1.png" width="541" height="412" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="596">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>chrom_size <span class="op">=</span> <span class="fl">12e5</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ylim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>xlim <span class="op">=</span> (<span class="dv">0</span>, chrom_size)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>data_height <span class="op">=</span> (ylim[<span class="dv">1</span>] <span class="op">-</span> ylim[<span class="dv">0</span>])</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>data_width <span class="op">=</span> (xlim[<span class="dv">1</span>] <span class="op">-</span> xlim[<span class="dv">0</span>])</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>aspect <span class="op">=</span> data_height <span class="op">/</span> data_width</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>aspect</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># data_width * aspect</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ylim = ylim * sub(*ylim) / sub(*xlim)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># chrom_size * sub(*ylim) / sub(*xlim)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="596">
<pre><code>2.5e-06</code></pre>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="586">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> sub</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> [(<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="fl">1e4</span>), (<span class="fl">3e4</span>, <span class="fl">1e4</span>), (<span class="fl">3e4</span>, <span class="dv">0</span>)]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>chrom_size <span class="op">=</span> <span class="fl">12e5</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ylim <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">3</span>])</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>xlim <span class="op">=</span> np.array([<span class="dv">0</span>, chrom_size])</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ylim <span class="op">=</span> sub()sub(ylim) <span class="op">/</span> sub(xlim) <span class="op">*</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, (ax, ax2) = plt.subplots(2, 1, figsize=(10, 1), sharex=True)</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">1</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="fl">6e5</span>, <span class="fl">6e5</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="fl">6e4</span>, <span class="fl">6e4</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'equal'</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># t = ax.text(0, 0, 'Text', fontsize=7, horizontalalignment='left',# weight='bold',</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                          verticalalignment='bottom', rotation=0, zorder=3, bbox=dict(boxstyle='square,pad=0', fc='red', ec='none', alpha=0.4))</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># box = t.get_bbox_patch()</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fig.canvas.draw()</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.axis('equal')</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_xlim(-6e5, 6e5)</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_ylim(-4e5, 4e5)</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # coords = ax.transData.inverted().transform(box.get_window_extent())</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="co"># #coords = ax.transAxes.transform(coords)</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # print(coords)</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co"># # print(ax.transLimits.transform(coords))</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ax.text(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">'Text'</span>, fontsize<span class="op">=</span><span class="dv">7</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>,<span class="co"># weight='bold',</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>                         verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, rotation<span class="op">=</span><span class="dv">0</span>, zorder<span class="op">=</span><span class="dv">3</span>, bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, fc<span class="op">=</span><span class="st">'red'</span>, ec<span class="op">=</span><span class="st">'none'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>))</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>transf <span class="op">=</span> ax.transData.inverted()</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>bb <span class="op">=</span> t.get_window_extent(renderer <span class="op">=</span> fig.canvas.get_renderer())</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>bbt <span class="op">=</span> bb.transformed(transf)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> bbt.get_points()</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>(x0, y0), (x1, y1) <span class="op">=</span> coords</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>coords.T, c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.scatter(*zip(*coords), transform=ax.transAxes, s=1, color='green', zorder=3)</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>coords)</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>(x<span class="op">=</span>x, y<span class="op">=</span>y))</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>dfx <span class="op">=</span> df[<span class="st">'x'</span>]<span class="op">*</span>math.cos(math.radians(<span class="dv">45</span>))<span class="op">-</span>df[<span class="st">'y'</span>]<span class="op">*</span>math.sin(math.radians(<span class="dv">45</span>))</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y'</span>] <span class="op">=</span> df[<span class="st">'x'</span>]<span class="op">*</span>math.sin(math.radians(<span class="dv">45</span>))<span class="op">+</span>df[<span class="st">'y'</span>]<span class="op">*</span>math.cos(math.radians(<span class="dv">45</span>))</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'x'</span>] <span class="op">=</span> dfx</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> np.array(<span class="bu">list</span>(<span class="bu">zip</span>(df.x, df.y)))</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>coords.T, c<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>coords))</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.axis('equal')</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_xlim(-6e5, 6e5)</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_ylim(-4e5, 4e5)</span></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>rect <span class="op">=</span> patches.Rectangle((<span class="op">-</span><span class="fl">6e5</span>, <span class="op">-</span><span class="fl">2e4</span>), <span class="fl">12e5</span>, <span class="fl">1e4</span>, color<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>ax.add_patch(rect) <span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-38-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="chrom_ideograms-Copy2_files/figure-html/cell-38-output-1.png" width="851" height="119" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="566">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ax.text(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="st">'Text'</span>, fontsize<span class="op">=</span><span class="dv">30</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>,<span class="co"># weight='bold',</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                         verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, rotation<span class="op">=</span><span class="dv">0</span>, zorder<span class="op">=</span><span class="dv">3</span>, bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, fc<span class="op">=</span><span class="st">'red'</span>, ec<span class="op">=</span><span class="st">'none'</span>))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>transf <span class="op">=</span> ax.transData.inverted()</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>bb <span class="op">=</span> t.get_window_extent(renderer <span class="op">=</span> fig.canvas.get_renderer())</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>bbt <span class="op">=</span> bb.transformed(transf)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> bbt.get_points()</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coords)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>(x0, y0), (x1, y1) <span class="op">=</span> coords</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt_coords <span class="op">=</span> np.array([(x0, y0), (x0, y1), (x1, y1), (x1, y0)])</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="op">*</span>plt_coords.T, c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.2        0.2       ]
 [1.97368952 0.30281385]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-39-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="chrom_ideograms-Copy2_files/figure-html/cell-39-output-2.png" width="545" height="417" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="391">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.transforms</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.transforms <span class="im">import</span> Bbox</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_polygon(t):</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    transf <span class="op">=</span> ax.transData.inverted()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    bb <span class="op">=</span> t.get_window_extent(renderer <span class="op">=</span> fig.canvas.get_renderer())</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    bbt <span class="op">=</span> bb.transformed(transf)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> bbt.get_points()</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    x0, y0 <span class="op">=</span> coords[<span class="dv">0</span>]</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    trafo <span class="op">=</span> matplotlib.transforms.Affine2D().rotate_around(x0,y0,<span class="op">-</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(trafo.transform(coords))</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co"># bb = t.get_window_extent(renderer = fig.canvas.get_renderer())</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coords = bb.get_points()</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords)</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x0, y0 = coords[0]</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(x0, y0)</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trafo = matplotlib.transforms.Affine2D().rotate_around(x0,y0,45)</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coords = bb.get_points()</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(coords)</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(trafo.transform(coords))</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transf = ax.transData.inverted()</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bb = t.get_window_extent(renderer = fig.canvas.get_renderer())</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bbt = bb.transformed(transf)</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # return bbt</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># b = bbt.bounds</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # print(dir(bbt), bbt.rotated(0.785398).corners())</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return Polygon([Point(b[0], b[1]), Point(bbt.xmin, b[1]+(b[0]-bbt.xmin)), Point(b[2], b[3]), Point(bbt.xmax, b[3]-(b[0]-bbt.xmin))])</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # return Polygon([Point(bbt.xmin, bbt.ymin), Point(bbt.xmin, bbt.ymin), Point(bbt.xmin, bbt.ymin), Point(bbt.xmin, bbt.ymin)])</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ax.text(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="st">'Text'</span>, fontsize<span class="op">=</span><span class="dv">17</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>,<span class="co"># weight='bold',</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>                         verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, rotation<span class="op">=</span><span class="dv">45</span>, zorder<span class="op">=</span><span class="dv">3</span>, bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, fc<span class="op">=</span><span class="st">'red'</span>, ec<span class="op">=</span><span class="st">'none'</span>))</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> get_polygon(t)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co">#xs, ys = zip(*[(p.x, p.y) for p in a.get_points()])</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="co"># print(xs, ys)</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ax.text(<span class="fl">0.1</span>, <span class="fl">0.23</span>, <span class="st">'Text'</span>, fontsize<span class="op">=</span><span class="dv">17</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>,<span class="co"># weight='bold',</span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>                         verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, rotation<span class="op">=</span><span class="dv">45</span>, zorder<span class="op">=</span><span class="dv">3</span>, bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'square,pad=0'</span>, fc<span class="op">=</span><span class="st">'red'</span>, ec<span class="op">=</span><span class="st">'none'</span>))</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.plot(xs,ys) </span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> get_polygon(t)</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>is_polygons_intersecting(a, b)</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a><span class="co">#print(Bbox.intersection(a, b))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.1        0.1       ]
 [0.25716788 0.0862437 ]]
[[0.1        0.23      ]
 [0.25716788 0.2162437 ]]</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[391], line 48</span>
<span class="ansi-green-fg ansi-bold">     46</span> <span style="font-style:italic;color:rgb(95,135,135)">#ax.plot(xs,ys) </span>
<span class="ansi-green-fg ansi-bold">     47</span> b <span style="color:rgb(98,98,98)">=</span> get_polygon(t)
<span class="ansi-green-fg">---&gt; 48</span> is_polygons_intersecting(a, b)

Cell <span class="ansi-green-fg">In[30], line 17</span>, in <span class="ansi-cyan-fg">is_polygons_intersecting</span><span class="ansi-blue-fg">(a, b)</span>
<span class="ansi-green-fg ansi-bold">     14</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">range</span>(<span style="color:rgb(98,98,98)">2</span>):
<span class="ansi-green-fg ansi-bold">     15</span>     polygon <span style="color:rgb(98,98,98)">=</span> a <span style="font-weight:bold;color:rgb(0,135,0)">if</span> x <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">0</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span> b
<span class="ansi-green-fg">---&gt; 17</span>     <span style="font-weight:bold;color:rgb(0,135,0)">for</span> i1 <span style="font-weight:bold;color:rgb(175,0,255)">in</span> <span style="color:rgb(0,135,0)">range</span>(<span style="color:rgb(0,135,0)">len</span>(polygon<span style="color:rgb(98,98,98)">.</span>get_points())):
<span class="ansi-green-fg ansi-bold">     18</span>         i2 <span style="color:rgb(98,98,98)">=</span> (i1 <span style="color:rgb(98,98,98)">+</span> <span style="color:rgb(98,98,98)">1</span>) <span style="color:rgb(98,98,98)">%</span> <span style="color:rgb(0,135,0)">len</span>(polygon<span style="color:rgb(98,98,98)">.</span>get_points())
<span class="ansi-green-fg ansi-bold">     19</span>         p1 <span style="color:rgb(98,98,98)">=</span> polygon<span style="color:rgb(98,98,98)">.</span>get_points()[i1]

<span class="ansi-red-fg">AttributeError</span>: 'NoneType' object has no attribute 'get_points'</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-40-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="chrom_ideograms-Copy2_files/figure-html/cell-40-output-3.png" width="554" height="417" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geneinfo</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>importlib.<span class="bu">reload</span>(geneinfo)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>gi.chrom_ideogram(annotation, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bbox(x0=72266463.49999999, y0=2.299999999999999, x1=78844788.63027559, y1=4.219218090860526)
Bbox(x0=38185129.999999985, y0=2.299999999999999, x1=43874492.27483292, y1=3.959864294798294)
Bbox(x0=2916660.500000015, y0=2.299999999999999, x1=8677139.803268358, y1=3.9806125984832725)
Bbox(x0=1428450.5, y0=2.299999999999999, x1=8042334.144493267, y1=4.229592242703012)
Bbox(x0=44533249.000000015, y0=2.299999999999999, x1=52320563.613677576, y1=4.571939253505164)
Bbox(x0=6908011.500000015, y0=2.299999999999999, x1=12632932.289050654, y1=3.9702384466407814)
Bbox(x0=53064702.000000015, y0=2.299999999999999, x1=60531989.985718235, y1=4.478571886922758)
Bbox(x0=119654546.99999999, y0=2.299999999999999, x1=127619654.1847661, y1=4.623810012717609)
Bbox(x0=48684013.500000015, y0=2.299999999999999, x1=53626646.976261124, y1=3.7420071061060156)
Bbox(x0=15840368.500000015, y0=2.299999999999999, x1=22169784.03075163, y1=4.146599027963099)
Bbox(x0=16742475.999999985, y0=2.299999999999999, x1=23107450.044969335, y1=4.15697317980559)
Bbox(x0=111713229.99999999, y0=2.299999999999999, x1=118042645.53075166, y1=4.146599027963099)
Bbox(x0=1597062.000000015, y0=2.299999999999999, x1=10059988.383813992, y1=4.769048138512458)
Bbox(x0=40692081.499999985, y0=2.299999999999999, x1=47341523.65871097, y1=4.239966394545505)
Bbox(x0=56565747.500000015, y0=2.299999999999999, x1=64246386.57102446, y1=4.540816797977694)
Bbox(x0=53398438.500000015, y0=2.299999999999999, x1=60225673.229799524, y1=4.29183715375795)
Bbox(x0=14016183.500000015, y0=2.299999999999999, x1=21447912.97150053, y1=4.468197735080267)
Bbox(x0=2784270.0, y0=2.299999999999999, x1=6482355.478641406, y1=3.37891179161889)
Bbox(x0=41161011.999999985, y0=2.299999999999999, x1=47739337.13027556, y1=4.219218090860526)
Bbox(x0=48896799.500000015, y0=2.299999999999999, x1=55510683.1444933, y1=4.2295922427030135)
Bbox(x0=44992983.500000015, y0=2.299999999999999, x1=51784659.71558182, y1=4.281463001915462)
Bbox(x0=53609424.000000015, y0=2.299999999999999, x1=60792243.87197657, y1=4.395578672182843)
Bbox(x0=13699816.000000015, y0=2.299999999999999, x1=20313699.644493297, y1=4.2295922427030135)
Bbox(x0=72646566.50000001, y0=2.299999999999999, x1=79260450.1444933, y1=4.2295922427030135)
Bbox(x0=20061809.999999985, y0=2.299999999999999, x1=27742449.071024433, y1=4.540816797977694)
Bbox(x0=70285815.99999999, y0=2.299999999999999, x1=77575311.41462968, y1=4.426701127710309)
Bbox(x0=40637241.000000015, y0=2.299999999999999, x1=47926736.41462971, y1=4.426701127710309)
Bbox(x0=76429526.00000001, y0=2.299999999999999, x1=84430191.6989838, y1=4.6341841645601)
Bbox(x0=2361155.5, y0=2.299999999999999, x1=9295065.772452638, y1=4.322959609285416)
Bbox(x0=85954370.49999999, y0=2.299999999999999, x1=90968121.0046965, y1=3.7627554097909943)
Bbox(x0=148750640.0, y0=2.299999999999999, x1=154048858.61843812, y1=3.845748624530909)
Bbox(x0=150437800.0, y0=2.299999999999999, x1=158331790.1563307, y1=4.60306170903263)
Bbox(x0=13667538.000000015, y0=2.299999999999999, x1=21597086.670548394, y1=4.613435860875121)
Bbox(x0=129754242.50000001, y0=2.299999999999999, x1=138430519.9691202, y1=4.831293049567396)
Bbox(x0=13723439.500000015, y0=2.299999999999999, x1=22399716.96912022, y1=4.831293049567396)
Bbox(x0=11766965.500000015, y0=2.299999999999999, x1=17242976.68952672, y1=3.897619383743354)
Bbox(x0=20133181.500000015, y0=2.299999999999999, x1=27031533.258234933, y1=4.312585457442928)
Bbox(x0=66215769.000000015, y0=2.299999999999999, x1=72082923.8459215, y1=4.011735054010739)
Bbox(x0=311072.0, y0=2.299999999999999, x1=7885035.528371349, y1=4.509694342450224)
Bbox(x0=154553122.5, y0=2.299999999999999, x1=160704745.4596631, y1=4.094728268750654)
Bbox(x0=16815475.499999985, y0=2.299999999999999, x1=23464917.658711, y1=4.239966394545505)
Bbox(x0=2716248.0, y0=2.299999999999999, x1=8156700.6753089875, y1=3.887245231900865)
Bbox(x0=30568287.499999985, y0=2.299999999999999, x1=35795389.09000276, y1=3.8250003208459304)
Bbox(x0=3327608.5, y0=2.299999999999999, x1=10190401.744017228, y1=4.302211305600441)
Bbox(x0=71099693.00000001, y0=2.299999999999999, x1=77855810.70136411, y1=4.271088850072971)
Bbox(x0=7475797.500000015, y0=2.299999999999999, x1=11920611.77721323, y1=3.5967689803111647)
Bbox(x0=103357475.49999999, y0=2.299999999999999, x1=110753646.4572828, y1=4.457823583237779)
Bbox(x0=47202994.499999985, y0=2.299999999999999, x1=52750122.7179621, y1=3.918367687428333)
Bbox(x0=115172356.00000001, y0=2.299999999999999, x1=121786239.6444933, y1=4.2295922427030135)
Bbox(x0=41348910.000000015, y0=2.299999999999999, x1=47998352.158711, y1=4.239966394545505)
Bbox(x0=2855820.0, y0=2.299999999999999, x1=8616299.303268328, y1=3.9806125984832725)
Bbox(x0=18297000.500000015, y0=2.299999999999999, x1=24910884.144493297, y1=4.2295922427030135)
Bbox(x0=15810425.000000015, y0=2.299999999999999, x1=22388750.130275592, y1=4.219218090860526)
Bbox(x0=2493695.0, y0=2.299999999999999, x1=8965344.587622449, y1=4.188095635333056)
Bbox(x0=74007178.49999999, y0=2.299999999999999, x1=78309758.72034238, y1=3.5552723729412072)
Bbox(x0=136179030.5, y0=2.299999999999999, x1=141477249.11843812, y1=3.845748624530909)
Bbox(x0=81157805.99999999, y0=2.299999999999999, x1=88269508.84354116, y1=4.374830368497864)
Bbox(x0=140783972.0, y0=2.299999999999999, x1=146473334.2748329, y1=3.959864294798294)
Bbox(x0=53273589.000000015, y0=2.299999999999999, x1=60456408.8719766, y1=4.395578672182843)
Bbox(x0=47223928.500000015, y0=2.299999999999999, x1=53695578.08762245, y1=4.188095635333056)
Bbox(x0=72036297.50000001, y0=2.299999999999999, x1=78543505.60184015, y1=4.198469787175547)
Bbox(x0=16854822.500000015, y0=2.299999999999999, x1=23397589.116057888, y1=4.208843939018035)
Bbox(x0=73836686.00000001, y0=2.299999999999999, x1=78743760.96204342, y1=3.731632954263528)
Bbox(x0=24066878.000000015, y0=2.299999999999999, x1=30751878.672928706, y1=4.250340546387992)
Bbox(x0=1389132.5, y0=2.299999999999999, x1=9567590.770072356, y1=4.686054923772543)
Bbox(x0=17555597.000000015, y0=2.299999999999999, x1=22320437.9051726, y1=3.6901363468935706)
Bbox(x0=24182714.000000015, y0=2.299999999999999, x1=28591969.762995526, y1=3.586394828468677)
Bbox(x0=138918752.0, y0=2.299999999999999, x1=145248167.53075165, y1=4.146599027963099)
Bbox(x0=68835590.50000001, y0=2.299999999999999, x1=75342798.60184018, y1=4.198469787175547)
Bbox(x0=78954529.50000001, y0=2.299999999999999, x1=86208466.40041198, y1=4.416326975867822)
Bbox(x0=1499883.000000015, y0=2.299999999999999, x1=7864857.044969365, y1=4.156973179805588)
Bbox(x0=1359652.5, y0=2.299999999999999, x1=7155690.317486033, y1=3.9909867503257583)
Bbox(x0=3658994.5, y0=2.299999999999999, x1=9348356.774832949, y1=3.959864294798294)
Bbox(x0=153932152.5, y0=2.299999999999999, x1=160403802.08762246, y1=4.188095635333056)
Bbox(x0=71105338.50000001, y0=2.299999999999999, x1=78394833.91462971, y1=4.426701127710309)
Bbox(x0=77903407.99999999, y0=2.299999999999999, x1=84659525.70136409, y1=4.271088850072971)
Bbox(x0=7912993.000000015, y0=2.299999999999999, x1=15344722.47150053, y1=4.468197735080267)
Bbox(x0=48514886.500000015, y0=2.299999999999999, x1=55591030.829323485, y1=4.364456216655377)
Bbox(x0=153959687.5, y0=2.299999999999999, x1=160680246.68714643, y1=4.260714698230483)
Bbox(x0=79160003.00000001, y0=2.299999999999999, x1=86627290.9857182, y1=4.478571886922758)
Bbox(x0=289839.0000000149, y0=2.299999999999999, x1=7792685.49993594, y1=4.488946038765246)
Bbox(x0=132049622.49999999, y0=2.299999999999999, x1=138272362.4880985, y1=4.115476572435632)
Bbox(x0=13756349.000000015, y0=2.299999999999999, x1=19339035.732179835, y1=3.928741839270824)
Bbox(x0=360444.0000000149, y0=2.299999999999999, x1=8823370.383814022, y1=4.769048138512458)
Bbox(x0=53200849.500000015, y0=2.299999999999999, x1=60063642.74401723, y1=4.302211305600441)
Bbox(x0=15738620.500000015, y0=2.299999999999999, x1=21285748.71796213, y1=3.918367687428333)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="chrom_ideograms-Copy2_files/figure-html/cell-41-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="chrom_ideograms-Copy2_files/figure-html/cell-41-output-2.png" width="660" height="700" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/munch-group\.github\.io\/geneinfo\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>